{"layout": 0, "type": "text", "text": "Label Words are Anchors: An Information Flow Perspective for Understanding In-Context Learning ", "text_level": 1, "page_idx": 0, "bbox": [100, 67, 496, 100], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 1, "type": "text", "text": "Lean Wang † , § , Lei  $\\mathbf{L}\\mathbf{i}^{\\dagger}$  , Damai Dai † , Deli Chen § , Hao Zhou § , Fandong Meng § , Jie Zhou § , Xu Sun † ", "page_idx": 0, "bbox": [175.82794189453125, 105, 421, 135.57379150390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 2, "type": "text", "text": "National Key Laboratory for Multimedia Information Processing, ", "page_idx": 0, "bbox": [144.61590576171875, 134.50845336914062, 459, 148.91445922851562], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 3, "type": "text", "text": "§ Pattern Recognition Center, WeChat AI, Tencent Inc., China {lean,daidamai,xusun}@pku.edu.cn nlp.lilei@gmail.com victorchen@deepseek.com {tuxzhou,fan dong meng,with tom zhou}@tencent.com ", "page_idx": 0, "bbox": [88.42189025878906, 162.51345825195312, 509.84271240234375, 203.57115173339844], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 4, "type": "text", "text": "Abstract ", "text_level": 1, "page_idx": 0, "bbox": [158, 214, 202, 225], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 5, "type": "text", "text": "In-context learning (ICL) emerges as a promis- ing capability of large language models (LLMs) by providing them with demonstration exam- ples to perform diverse tasks. However, the un- derlying mechanism of how LLMs learn from the provided context remains under-explored. In this paper, we investigate the working mech- anism of ICL through an information flow lens. Our findings reveal that label words in the demonstration examples function as anchors: (1) semantic information aggregates into label word representations during the shallow compu- tation layers’ processing; (2) the consolidated information in label words serves as a reference for LLMs’ final predictions. Based on these in- sights, we introduce an anchor re-weighting method to improve ICL performance, a demon- stration compression technique to expedite in- ference, and an analysis framework for diag- nosing ICL errors in GPT2-XL. The promising applications of our findings again validate the uncovered ICL working mechanism and pave the way for future studies. ", "page_idx": 0, "bbox": [87, 235.8255615234375, 273, 510.8445129394531], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 6, "type": "text", "text": "1 Introduction ", "text_level": 1, "page_idx": 0, "bbox": [70, 520, 154, 534], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 7, "type": "text", "text": "In-context Learning (ICL) has emerged as a power- ful capability alongside the development of scaled- up large language models (LLMs) ( Brown et al. , 2020 ). By instructing LLMs using few-shot demon- stration examples, ICL enables them to perform a wide range of tasks, such as text classification ( Min et al. ,  2022a ) and mathematical reasoning ( Wei et al. ,  2022 ). Since ICL does not require updates to millions or trillions of model parameters and relies on human-understandable natural language instructions ( Dong et al. ,  2023 ), it has become a promising approach for harnessing the full poten- tiality of LLMs. Despite its significance, the inner working mechanism of ICL remains an open ques- tion, garnering considerable interest from research ", "page_idx": 0, "bbox": [70, 542.2639770507812, 290, 745.0984497070312], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 8, "type": "image", "page_idx": 0, "img_path": "layout_images/2305.14160v4_0.jpg", "img_caption": "", "bbox": [310, 209, 519, 459], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Review Review Review Review\n\ni ye q é\nA fy Vi A A A\ngood good good good\nmovie Yj movie movie movie\nsett f/f, Sent Sent\niment Y Z. iment iment\n, Positive Positive Positive\nReview Review Review Review\nwaste waste “\"\" waste waste\nof of of of\nmoney money money money\nSent Sent Sent Sent\niment iment iment iment\nNecitive Negative Negative Negative\nReview Review Review Review\nfantastic fantastic fantastic fantastic\nSent Sent Sent Sent\niment iment iment iment\n", "vlm_text": "The image appears to depict a diagram related to sentiment analysis. It shows the mapping of reviews to sentiment labels such as \"Positive\" and \"Negative.\" Phrases like \"A good movie\" and \"waste of money\" are connected to their respective sentiments. The diagram seems to illustrate the process or flow of data through multiple stages or models, with emphasis on how reviews are categorized by sentiment over time or iterations. Each connection line indicates the association between the review text and its sentiment classification."}
{"layout": 9, "type": "text", "text": "Figure 1: Visualization of the information flow in a GPT model performing ICL. The line depth reflects the sig- nificance of the information flow from the right word to the left. The flows involving label words are highlighted. Label words gather information from demonstrations in shallow layers, which is then extracted in deep layers for final prediction. ", "page_idx": 0, "bbox": [306, 470.71356201171875, 526, 554.4495239257812], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 10, "type": "text", "text": "communities ( Xie et al. ,  2022 ;  Dai et al. ,  2022 ; Akyürek et al. ,  2022 ;  Li et al. ,  2023b ). ", "text_level": 1, "page_idx": 0, "bbox": [305, 576, 526, 603], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 11, "type": "text", "text": "In this paper, we find that the label words serve as anchors that aggregate and distribute information in ICL. We first visualize the attention interactive pattern between tokens with a GPT model ( Brown et al. ,  2020 ) on sentiment analysis (Figure  1 ). Ini- tial observations suggest that label words aggregate information in shallow layers and distribute it in deep layers.   To draw a clearer picture of this phe- nomenon, we design two metrics based on saliency ", "page_idx": 0, "bbox": [306, 603.281982421875, 526, 724.8204345703125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 12, "type": "image", "page_idx": 1, "img_path": "layout_images/2305.14160v4_1.jpg", "img_caption": "Figure 2: Illustration of our hypothesis. In shallow layers, label words gather information from demonstrations to form semantic representations for deeper processing, while deep layers extract and utilize this information from label words to formulate the final prediction. ", "bbox": [69, 69, 526, 251], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "\\ formation aBBregation \\nformation aBsregatio,,\n\n: Label Prediction\n\na Aa.\n\n", "vlm_text": "The image is an illustration explaining a hypothesis about how information is processed in different layers of a model for sentiment analysis.\n\n- **Shallow Layers**: These layers perform \"information aggregation\" where they gather semantic information from demonstration examples. The words \"Negative\" and \"Positive\" are used to indicate sentiment in reviews.\n- **Deep Layers**: These utilize the aggregated information to make a final prediction, as indicated by the label \"Label Prediction.\" The predictions are based on previously identified sentiments (negative and positive).\n\nThe image shows a flow of information, indicating processing from shallow to deep layers."}
{"layout": 13, "type": "text", "text": "scores to portray the information flow in ICL and further propose the following hypothesis: ", "page_idx": 1, "bbox": [70, 272.33099365234375, 291, 299.0254821777344], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 14, "type": "text", "text": "Information Flow with Labels as Anchors  $\\mathcal{H}_{1}$  : In shallow layers, label words gather the information of demonstrations to form seman- tic representations for deeper layers.  $\\mathcal{H}_{2}$  : In deep layers, the model extracts the information from label words to form the final prediction. ", "page_idx": 1, "bbox": [79, 305.6500244140625, 280, 400.0914611816406], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 15, "type": "text", "text": "Two experiments are designed to validate the hy- pothesis using GPT2-XL ( Radford et al. ,  2019 ) and GPT-J ( Wang and Komatsu zak i ,  2021 ) across sev- eral text classification benchmarks. (1) By blocking the information aggregation path to label words in certain layers, we find that such isolation in shal- low layers significantly impairs model performance. This indicates that label words collect useful in- formation during forward propagation in shallow layers. (2) We investigate the relationship between the attention distributions on the label words of the target position and the model’s final prediction. Our results illustrate a strong positive correlation, where a candidate label’s probability increases with more attention weight on its corresponding label token. In summary, these experimental findings suggest that our hypothesis holds well with large language models on real-world datasets. ", "page_idx": 1, "bbox": [70, 408.0570068359375, 291, 651.5384521484375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 16, "type": "text", "text": "Drawing on insights from the information flow perspective, we explore three approaches to en- hance ICL’s effectiveness, efficiency, and inter- pre t ability. (1) An anchor re-weighting method is introduced, which employs a learnable vector to adjust the significance of different label words in demonstrations, leading to a   $16.7\\%$   average accu- racy boost compared to standard ICL baselines. (2) For quicker ICL inference, inputs are compressed into pre-calculated anchor representations since model predictions primarily rely on label word acti- vations. Testing shows a  $1.8\\times$   speedup in inference with only a minimal performance trade-off. (3) An error analysis of ICL on GPT2-XL demonstrates that the label confusion matrix aligns closely with the distance distribution of anchor key vectors, im- plying that errors might result from similar anchor representations. These promising applications fur- ther validate our hypothesis and shed light on future ICL studies for better transparency of LLMs. ", "page_idx": 1, "bbox": [70, 652.5499877929688, 291, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 17, "type": "text", "text": "", "page_idx": 1, "bbox": [305, 272.33099365234375, 526, 420.9684753417969], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 18, "type": "text", "text": "2 Label Words are Anchors ", "text_level": 1, "page_idx": 1, "bbox": [306, 431, 456, 445], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 19, "type": "text", "text": "This section confirms the intuitive findings using two saliency score-based metrics as discussed in  $\\S~2.1$  . The quantitative results lead to a proposed hypothesis for the ICL working mechanism:    $\\mathcal{H}_{1}$  : In shallow layers, label words aggregate information from demonstration examples to form semantic representations for later computations.    $\\mathcal{H}_{2}$  : In deep layers, the model makes predictions by extracting information from label words. The validation for these hypotheses is presented in   $\\S~2.2$   and   $\\S~2.3$  , respectively. ", "page_idx": 1, "bbox": [305, 453.24700927734375, 526, 601.8844604492188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 20, "type": "text", "text": "2.1 Hypothesis Motivated by Saliency Scores ", "text_level": 1, "page_idx": 1, "bbox": [305, 612, 522, 625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 21, "type": "text", "text": "This section aims to discover the inherent patterns in the attention interaction between tokens for a GPT model. The saliency technique ( Simonyan et al. ,  2013 ), a common interpretation tool, is em- ployed for highlighting critical token interactions. Following common practice, we use the Taylor expansion ( Michel et al. ,  2019 ) to calculate the saliency score for each element of the attention matrix: ", "page_idx": 1, "bbox": [305, 629.2839965820312, 526, 750.8224487304688], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 22, "type": "equation", "text": "\n$$\nI_{l}=\\left|\\sum_{h}A_{h,l}\\odot\\frac{\\partial\\mathcal{L}(\\boldsymbol{x})}{\\partial A_{h,l}}\\right|.\n$$\n ", "text_format": "latex", "page_idx": 1, "bbox": [364, 748.25, 466, 777], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 23, "type": "text", "text": "Here,    $A_{h,l}$   is the value of the attention matrix of the  $h$  -th attention head in the    $l$  -th layer,    $x$   is the input, and    $\\mathcal{L}(\\boldsymbol{x})$   is the loss function of the task, e.g., the cross-entropy objective for a classification problem. We average all attention heads to obtain the saliency matrix    $I_{l}$   for the    $l.$  -th layer.    $I_{l}(i,j)$  represents the significance of the information flow from the    $j$  -th word to the    $i$  -th word for ICL. By observing  $I_{l}$  , we can get an intuitive impression that as the layer goes deeper, demonstration label words will become more dominant for the prediction, as depicted in Figure  1 . ", "page_idx": 2, "bbox": [70, 71.74500274658203, 291, 233.93148803710938], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 24, "type": "text", "text": "To draw a clearer picture of this phenomenon, we propose three quantitative metrics based on    $I_{l}$  . Our focus lies in three components: (i) the label words, such as “Negative” and “Positive” in Fig- ure  2 , denoted as    $p_{1},...,p_{C}$  , where    $C$   represents the total number of label words; 4   (ii) the target po- sition, where the model generates prediction labels (i.e., the final token in the input), which we denote as    $q$  ; and (iii) the text part, i.e., the tokens before label words in the demonstration. ", "page_idx": 2, "bbox": [70, 234.3360137939453, 291, 369.4234619140625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 25, "type": "text", "text": "The definitions of the three quantitative metrics follow below. ", "page_idx": 2, "bbox": [70, 369.8280029296875, 291, 396.5224609375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 26, "type": "text", "text": " $S_{w p}$  , the mean significance of information flow from the text part to label words: ", "text_level": 1, "page_idx": 2, "bbox": [70, 397, 289, 423], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 27, "type": "equation", "text": "\n$$\n\\begin{array}{l}{S_{w p}=\\displaystyle\\frac{\\sum_{(i,j)\\in C_{w p}}I_{l}\\big(i,j\\big)}{\\vert C_{w p}\\vert},}\\\\ {C_{w p}=\\{(p_{k},j):k\\in[1,C],j<p_{k}\\}.}\\end{array}\n$$\n ", "text_format": "latex", "page_idx": 2, "bbox": [108, 430, 251, 473], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 28, "type": "text", "text": " $S_{p q}$  , the mean significance of information flow from label words to the target position: ", "page_idx": 2, "bbox": [70, 479, 291, 506.9250183105469], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 29, "type": "equation", "text": "\n$$\n\\begin{array}{l l}{S_{p q}=\\frac{\\sum_{(i,j)\\in C_{p q}}I_{l}(i,j)}{|C_{p q}|},}\\\\ {C_{p q}=\\{(q,p_{k}):k\\in[1,C]\\}.}\\end{array}\n$$\n ", "text_format": "latex", "page_idx": 2, "bbox": [123, 512, 235, 555], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 30, "type": "text", "text": " $S_{w w}$  , the mean significance of the information flow amongst all words, excluding influences represented by  $S_{w p}$   and    $S_{p q}$   : ", "text_level": 1, "page_idx": 2, "bbox": [70, 562, 290, 603], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 31, "type": "equation", "text": "\n$$\n\\begin{array}{l}{S_{w w}=\\!\\frac{\\sum_{(i,j)\\in C_{w w}}I_{l}(i,j)}{|C_{w w}|},}\\\\ {C_{w w}=\\!\\{(i,j):j<i\\}-C_{w p}-C_{p q}.}\\end{array}\n$$\n ", "text_format": "latex", "page_idx": 2, "bbox": [108, 610, 250, 652], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 32, "type": "text", "text": " $S_{w p},S_{p q}$  , and    $S_{w w}$   help assess different informa- tion flows in the model.    $S_{w p}$   indicates the intensity of information aggregation onto label words. A high    $S_{p q}$   demonstrates a strong information extrac- tion from label words for final decision-making.  $S_{w w}$   assesses average information flow among words, serving as a benchmark to gauge the in- tensity of the patterns identified by    $S_{w p}$   and    $S_{p q}$  . ", "page_idx": 2, "bbox": [70, 658.864990234375, 291, 699.1084594726562], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 33, "type": "text", "text": "", "page_idx": 2, "bbox": [305, 71.74500274658203, 526, 140.72348022460938], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 34, "type": "text", "text": "Experimental Settings We choose GPT2-XL from the GPT series ( Radford et al. ,  2019 ) as our primary model for investigation, due to its moder- ate model size (of 1.5B parameters) that is suitable for our hardware resource and its decent ICL perfor- mance ( Dai et al. ,  2022 ). For datasets, we use Stan- ford Sentiment Treebank Binary (SST-2) ( Socher et al. ,  2013 ) for sentiment analysis, Text REtrieval Conference Question Classification (TREC) ( Li and Roth ,  2002 ;  Hovy et al. ,  2001 ) for question type classification, AG’s news topic classification dataset (AGNews) ( Zhang et al. ,  2015 ) for topic classification, and EmoContext (EmoC) ( Chatterjee et al. ,  2019 ) for emotion classification. Templates for constructing demonstrations are provided in Appendix  A .  1000  examples are sampled from the test set for evaluation, with one demonstration per class sampled from the training set. Experiments with more demonstrations yield similar outcomes (refer to Appendix  F.1  for details). Results reflect averages from five random seeds. ", "page_idx": 2, "bbox": [305, 147.3332977294922, 526, 431.85546875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 35, "type": "text", "text": "Results and Analysis Figure  3  reveals that: (1) in shallow layers,    $S_{p q}$  , the significance of the infor- mation flow from label words to targeted positions, is low, while    $S_{w p}$  , the information flow from the text part to label words is high; (2) in deep layers,  $S_{p q}$  , the importance of information flow from label words to the targeted position becomes the dom- inant one. Notably,    $S_{p q}$   and    $S_{w p}$   usually surpass  $S_{w w}$  , suggesting that interactions involving label words outweigh others. ", "page_idx": 2, "bbox": [305, 440.10028076171875, 526, 575.5814208984375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 36, "type": "text", "text": "Proposed Hypothesis Based on this, we propose the hypothesis that label words function as anchors in the ICL information flow. In shallow layers, label words gather information from demonstra- tion examples to form semantic representations for deeper layers, while in deep layers, the model ex- tracts the information from label words to form the final prediction. Figure  2  gives an illustration for our hypothesis. ", "page_idx": 2, "bbox": [305, 583.8273315429688, 526, 705.7584228515625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 37, "type": "text", "text": "2.2 Shallow Layers: Information Aggregation ", "text_level": 1, "page_idx": 2, "bbox": [306, 717, 525, 729], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 38, "type": "text", "text": "In this part, we validate our hypothesis’ first compo- nent. We assume that the information aggregation in ICL relies on the information flow from the text ", "page_idx": 2, "bbox": [305, 733.8450317382812, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 39, "type": "image", "page_idx": 3, "img_path": "layout_images/2305.14160v4_2.jpg", "img_caption": "(a) Results on the SST-2 dataset ", "bbox": [84, 84, 269, 241], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.8\n\n0.6\n\n0.4\n\n0.2\n\n0.0\n\n10\n\n20\nLayer\n\n30\n\n40\n\n", "vlm_text": "The image is a line graph showing the results on the SST-2 dataset. It displays three different lines, each representing a variable, against the number of layers (from 0 to 50) on the x-axis. The y-axis represents the values of \"S,\" ranging from 0.0 to 1.0.\n\n- The blue line represents \\( S_{wp} \\).\n- The orange line represents \\( S_{pq} \\).\n- The green line represents \\( S_{ww} \\).\n\nThe graph includes a legend indicating which color corresponds to each variable. The general trend shows that \\( S_{pq} \\) increases significantly as the layer number increases, while \\( S_{wp} \\) decreases, and \\( S_{ww} \\) remains relatively stable around a lower value."}
{"layout": 40, "type": "image", "page_idx": 3, "img_path": "layout_images/2305.14160v4_3.jpg", "img_caption": "(b) Results on the AGNews dataset ", "bbox": [84, 265, 267, 422], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.8\n\n0.6\n\n0.4\n\n0.2\n\n0.0\n\n10\n\n20\nLayer\n\n30\n\n40\n\n", "vlm_text": "The image is a line graph showing results on the AGNews dataset. It has three lines representing different metrics or scores measured across layers of a model:\n\n- The blue line represents \\( S_{wp} \\).\n- The orange line represents \\( S_{pq} \\).\n- The green line represents \\( S_{ww} \\).\n\nThe x-axis is labeled \"Layer,\" and the y-axis is labeled \"S,\" which might represent a score or similarity measure. The graph shows how these values change across different layers of a model. The orange line \\( S_{pq} \\) reaches a value of 1 early on and remains stable, while the blue \\( S_{wp} \\) and green \\( S_{ww} \\) lines have fluctuations and generally lower values."}
{"layout": 41, "type": "text", "text": "Figure 3: Relative sizes of    $S_{w p}$  ,  $S_{p q}$  , and  $S_{w w}$   in dif- ferent layers on SST-2 and AGNews. Results of other datasets can be found in Appendix  B . Initially,    $S_{w p}$   oc- cupies a significant proportion, but it gradually decays over layers, while    $S_{p q}$   becomes the dominant one. ", "page_idx": 3, "bbox": [70, 430.6575622558594, 290, 491.9775085449219], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 42, "type": "text", "text": "part to label tokens, which is facilitated by the trans- former’s attention mechanism. By manipulating the attention layer in the model to block this flow and examining the model behavior change, we val- idate the existence of the information aggregation process and its contribution to the final prediction. ", "page_idx": 3, "bbox": [70, 512.927001953125, 290, 593.8184814453125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 43, "type": "text", "text": "Experimental Settings We retain the same test sample size of 1000 inputs as   $\\S~2.1$  . We use the same demonstration for a single random seed. To further validate our findings on larger models, we incorporate GPT-J (6B) ( Wang and Komatsu zak i , 2021 ) in experiments, which exceeds GPT2-XL in model size and capacity. ", "page_idx": 3, "bbox": [70, 602.6693115234375, 290, 697.50341796875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 44, "type": "text", "text": "Implementation Details To block the informa- tion flow to label words, we isolate label words by manipulating the attention matrix    $A$  . Specifi- cally, we set    $A_{l}(p,i)(i<p)$   to 0 in the attention matrix    $A_{l}$   of the    $l$  -th layer, where  $p$   represents label ", "page_idx": 3, "bbox": [70, 706.3543090820312, 290, 775.866455078125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 45, "type": "image", "page_idx": 3, "img_path": "layout_images/2305.14160v4_4.jpg", "img_caption": "Figure 4: The impact of isolating label words versus randomly isolating non-label words within the first or last 5 layers. Isolating label words within the first 5 lay- ers exerts the most substantial impact, highlighting the importance of shallow-layer information aggregation via label words. ", "bbox": [304, 73, 527, 303], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Loyalty\n\nNo Isolation jm Label Words (Last) limi. Random (Last)\nj@m Label Words (First) mmm Random (First)\n\n100\n\n80\n\n60\n\n40\n\n20\n\nLabel Loyalty Word Loyalty Label Loyalty Word Loyalty\n(GPT2-XL) (GPT2-XL) (GPT) (GPT)\n\n", "vlm_text": "The image is a bar graph illustrating the impact of isolating label words versus randomly isolating non-label words within the first or last five layers of a model. The x-axis represents different conditions: \"Label Loyalty (GPT2-XL),\" \"Word Loyalty (GPT2-XL),\" \"Label Loyalty (GPT-J),\" and \"Word Loyalty (GPT-J).\" The y-axis shows \"Loyalty,\" presumably a measure of performance.\n\nThere are four types of isolation labeled in the legend:\n\n- **No Isolation** (dashed green line)\n- **Label Words (Last)** (orange)\n- **Label Words (First)** (blue)\n- **Random (First)** (pink)\n- **Random (Last)** (purple)\n\nKey insights include that isolating label words within the first five layers shows a substantial impact, emphasizing the significance of shallow-layer information aggregation through label words."}
{"layout": 46, "type": "text", "text": "words and  $i$   represents preceding words. Conse- quently, in the  $l$  -th layer, label words cannot access information from the prior demonstration text. ", "page_idx": 3, "bbox": [305, 324.2969970703125, 526, 364.54046630859375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 47, "type": "text", "text": "Metrics We use the following metrics to assess the impact of blocking information flow from the text part to label tokens:  (1) Label Loyalty:  mea- sures the consistency of output labels with and without isolation.  (2) Word Loyalty:  employs the Jaccard similarity to compare the top-5 predicted words with and without isolation, capturing more subtle model output alterations (See Appendix  C for details). Low loyalty indicates a profound im- pact of isolation on model predictions. ", "page_idx": 3, "bbox": [305, 372.6652526855469, 526, 508.146484375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 48, "type": "text", "text": "Results and Analysis Figure  4  illustrates a no- table influence on the model’s behavior when label words are isolated within the first 5 layers. Yet, this influence becomes inconsequential within the last 5 layers, or when random non-label words are used. This observation underlines the fundamental impor- tance of shallow-layer information aggregation via label words in ICL. It also emphasizes the superi- ority of label words over non-label words. Further tests with variable numbers of layers reaffirm these findings (Appendix  D ). Moreover, similar results were obtained when testing ICL with semantically unrelated labels (refer to Appendix  F.2 ). ", "page_idx": 3, "bbox": [305, 516.2713012695312, 526, 692.3994140625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 49, "type": "text", "text": "2.3 Deep Layers: Information Extraction ", "text_level": 1, "page_idx": 3, "bbox": [306, 703, 506, 715], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 50, "type": "text", "text": "We proceed to validate the latter part of our hy- pothesis that the model extracts information from label words to form the final prediction. We de- note the sum of the attention matrices in the    $l$  -th layer as    $A_{l}$  .   In deeper layers, we find a strong correlation between the attention distributions on the label words of the target position, represented as    $(A_{l}(q,p_{1}),...,A_{l}(q,p_{C}))$  , and the model’s final prediction, affirming our hypothesis. The experi- mental setup mirrors that discussed in  $\\S~2.2$  . ", "page_idx": 3, "bbox": [305, 720.2960205078125, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 51, "type": "text", "text": "", "page_idx": 4, "bbox": [70, 67.78601837158203, 291, 152.63650512695312], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 52, "type": "text", "text": "2.3.1 Experiments ", "text_level": 1, "page_idx": 4, "bbox": [70, 161, 163, 173], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 53, "type": "text", "text": "We utilize the AUC-ROC score to quantify the cor- relation between    $A_{l}(q,p_{i})$   and model prediction, which we denote as    $\\mathrm{AUCRO C}_{l}$   for the    $l$  -th layer. We prefer the AUC-ROC metric due to two pri- mary reasons: (1)    $A_{l}(q,p_{i})$   might differ from the probability of the model outputting label    $i$   by a constant factor. As  Kobayashi et al.  ( 2020 ) points out, attention should be multiplied by the norm of the key vector to yield ’more interpret able atten- tion’. The AUC-ROC metric can implicitly account for these factors, thus allowing us to uncover the correlation more effectively. (2) The proportion of different labels output by the model may be un- balanced. Using the AUC-ROC metric can help mitigate this issue, reducing disturbances caused by class imbalance. ", "page_idx": 4, "bbox": [70, 176.3610382080078, 291, 392.7444763183594], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 54, "type": "text", "text": "Considering the residual mechanism of trans- formers, we can view each layer’s hidden state as the cumulative effect of all prior layer calculations. To quantify the accumulated contribution of the first  $l$   layers to model prediction, we introduce  $R_{l}$  : ", "page_idx": 4, "bbox": [70, 393.14801025390625, 291, 460.490478515625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 55, "type": "equation", "text": "\n$$\nR_{l}=\\frac{\\sum_{i=1}^{l}(\\mathrm{ALCROC}_{i}-0.5)}{\\sum_{i=1}^{N}(\\mathrm{ALCROC}_{i}-0.5)}.\n$$\n ", "text_format": "latex", "page_idx": 4, "bbox": [118, 468, 240, 497], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 56, "type": "text", "text": "This measure tracks the positive contribution above a baseline AUC-ROC threshold of 0.5. The value of  $R_{l}$   signifies the proportional contribution of the first  $l$   layers to the model prediction. ", "page_idx": 4, "bbox": [70, 505.32904052734375, 291, 559.1214599609375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 57, "type": "text", "text": "2.3.2 Results and Analysis ", "text_level": 1, "page_idx": 4, "bbox": [71, 568, 200, 580], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 58, "type": "text", "text": "Figures  5a  and  5b  delineate correlation metrics for GPT2-XL and GPT-J, averaged across four datasets. The    $\\mathrm{AUCRO C}_{l}$   for deep layers approaches  0 . 8 , il- lustrating a strong correlation between the attention distributions on label words of the target position and the model’s final prediction. Moreover, shal- low layers show negligible cumulative contribu- tions   $(R_{l})$  , with a significant increase in middle and deep layers. These results signify the crucial role of deep layers for final prediction, validating that the model extracts information from label words in deep layers to form the final prediction. ", "page_idx": 4, "bbox": [70, 582.8460083007812, 291, 745.032470703125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 59, "type": "image", "page_idx": 4, "img_path": "layout_images/2305.14160v4_5.jpg", "img_caption": "Figure 5:    $\\mathrm{AUCRO C}_{l}$   and    $R_{l}$   of each layer in GPT mod- els. The result is averaged over SST-2, TREC, AGNews, and Emoc.    $\\mathrm{AUCRO C}_{l}$   reaches 0.8 in deep layers, and  $R_{l}$   increases mainly in the middle and later layers. ", "bbox": [305, 68, 526, 416], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "ec 2 © + 4 8\na co 6 6 co o\nc\na\n2\n4\no\n> | an\nBS] Tsoa-- 25\n00\n+ a\no 3 a\ns 8\n3 2\ngc\n4\n\"\nN\n[ =\nOo\ne) fe}\n> 15\n& |S\nzt\n1\n1\n2 2 RF 2 4\nSoS 6 6 cS oo\n\n'QouDNV\n\n20 25\n\n15\nLayers\n(b) GPT-J (total 28 layers).\n\n10\n", "vlm_text": "The image contains two plots comparing the performance metrics $\\mathrm{AUCRO C}_{l}$ and $R_{l}$ across different layers of GPT models.\n\n1. **Top Plot (a) GPT2-XL:**\n   - Shows results for GPT2-XL with a total of 48 layers.\n   - $\\mathrm{AUCRO C}_{l}$ (blue dashed line) measures a value on the left y-axis and generally increases, reaching around 0.85 in the deeper layers.\n   - $R_{l}$ (solid red line) measures a value on the right y-axis and mostly increases from the middle to later layers.\n\n2. **Bottom Plot (b) GPT-J:**\n   - Shows results for GPT-J with a total of 28 layers.\n   - $\\mathrm{AUCRO C}_{l}$ (blue dashed line) measures a value on the left y-axis and increases, reaching around 0.9 in the deeper layers.\n   - $R_{l}$ (solid red line) follows a similar trend as in GPT2-XL, increasing in the middle and later layers.\n\nBoth plots suggest that as layers deepen in the models, the performance metrics tend to improve."}
{"layout": 60, "type": "text", "text": "2.4 Discussion of Our Hypothesis ", "text_level": 1, "page_idx": 4, "bbox": [305, 438, 468, 451], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 61, "type": "text", "text": "In  $\\S~2.2$  , we have affirmed that the model’s shallow layers assemble information from demonstrations via label words to form semantic representations. In   $\\S~2.3$  , we verify that the aforementioned aggre- gated information on label words is then extracted to form the final prediction in the deep layers. Rec- ognizing the crucial function of label words in this process, we have introduced the term “Anchors” to denote them. Given the considerable role these “anchors” fulfill, we find it intuitive to design ICL improvements based on them, as elaborated in   $\\S\\ 3$  . ", "page_idx": 4, "bbox": [305, 455.95098876953125, 526, 604.5884399414062], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 62, "type": "text", "text": "3 Applications of Our Anchor-Based Understanding ", "text_level": 1, "page_idx": 4, "bbox": [306, 616, 501, 644], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 63, "type": "text", "text": "With insights from the validated hypothesis, we propose strategies to boost ICL’s accuracy and in- ference speed. We propose an anchor re-weighting method in  $\\S\\,3.1$   to adjust the demonstrations’ contri- butions and improve accuracy. In   $\\S\\ 3.2$  , we explore a context compression technique that reduces origi- nal demonstrations to anchor hidden states to speed up ICL inference. Besides, in  $\\S\\ 3.3$  , we utilize an- chor distances to perform an analysis to understand the errors ICL made in real-world scenarios. These approaches corroborate our hypothesis, pointing to potential paths for future ICL enhancements. ", "page_idx": 4, "bbox": [305, 652.5499877929688, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 64, "type": "text", "text": "", "page_idx": 5, "bbox": [70, 71.74500274658203, 290, 111.98947143554688], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 65, "type": "text", "text": "3.1 Anchor Re-weighting ", "text_level": 1, "page_idx": 5, "bbox": [70, 122, 196, 134], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 66, "type": "text", "text": "Based on our analysis in   $\\S~2$  , we draw parallels between ICL and logistic regression and propose an approach to improve ICL’s accuracy by re- weighting label anchors. ", "page_idx": 5, "bbox": [70, 138.5189971923828, 290, 192.31149291992188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 67, "type": "text", "text": "3.1.1 Method ", "text_level": 1, "page_idx": 5, "bbox": [70, 200, 140, 212], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 68, "type": "text", "text": " $\\S~2.3$   illustrates a strong correlation between the model’s output category and the attention distri- bution    $\\left(A\\left(q,p_{1}\\right),\\ldots,A\\left(q,p_{C}\\right)\\right)$   on label words  $p_{1},...,p_{C}$   of the target position    $q$   in deep layers. We can view the attention module as a classifier    $\\pmb{f}$  , ", "page_idx": 5, "bbox": [70, 215.89601135253906, 290, 283.2384948730469], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 69, "type": "equation", "text": "\n$$\n\\begin{array}{r l}&{\\quad\\operatorname*{Pr}_{\\pmb{f}}(Y=i|X=x)}\\\\ &{{\\approx}A(q,p_{i})}\\\\ &{{=}\\frac{\\exp(\\mathbf{q}_{q}\\mathbf{k}_{p_{i}}^{T}/\\sqrt{d})}{\\sum_{j=1}^{N}\\exp(\\mathbf{q}_{q}\\mathbf{k}_{j}^{T}/\\sqrt{d})}.}\\end{array}\n$$\n ", "text_format": "latex", "page_idx": 5, "bbox": [129, 289, 229, 348], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 70, "type": "text", "text": "By setting  $\\ensuremath{\\mathbf{q}}_{q}/\\sqrt{d}=\\hat{\\ensuremath{\\mathbf{x}}}$   and  $\\mathbf{k}_{p_{i}}-\\mathbf{k}_{p_{C}}=\\beta_{i}$  , we deduce: ", "page_idx": 5, "bbox": [70, 355, 290, 383.80548095703125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 71, "type": "equation", "text": "\n$$\n\\log{\\frac{\\operatorname*{Pr}_{f}(Y=i|X=x)}{\\operatorname*{Pr}_{f}(Y=C|X=x)}}={\\boldsymbol{\\beta}}_{i}^{T}{\\hat{\\mathbf{x}}}.\n$$\n ", "text_format": "latex", "page_idx": 5, "bbox": [115, 389, 243, 413], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 72, "type": "text", "text": "This approximates a logistic regression model where: ", "page_idx": 5, "bbox": [70, 420.656005859375, 290, 447.3504638671875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 73, "type": "equation", "text": "\n$$\n\\log\\frac{\\operatorname*{Pr}_{\\boldsymbol{f}}(Y=i|X=x)}{\\operatorname*{Pr}_{\\boldsymbol{f}}(Y=C|X=x)}={\\beta_{0}^{i}}+{\\beta_{i}^{T}}\\mathbf{x}.\n$$\n ", "text_format": "latex", "page_idx": 5, "bbox": [105, 452, 253, 476], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 74, "type": "text", "text": "In this equation,  $\\beta_{0}^{i}$    and  $\\beta_{i}^{T}$    are parameters that can be learned, while  $\\mathbf{x}$   is the input feature. ", "page_idx": 5, "bbox": [70, 485, 290, 513.366455078125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 75, "type": "text", "text": "Inspired by the similarity between ICL and lo- gistic regression, we’ve incorporated a learnable  $\\beta_{0}^{i}$    into Eq. ( 7 ), which is equivalent to adjusting the attention weights  $A(q,p_{i})$  : ", "page_idx": 5, "bbox": [70, 513.7699584960938, 290, 568], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 76, "type": "equation", "text": "\n$$\n\\hat{A}(q,p_{i})=\\exp(\\beta_{0}^{i})A(q,p_{i})\n$$\n ", "text_format": "latex", "page_idx": 5, "bbox": [117, 574, 242, 592], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 77, "type": "text", "text": "Each  $\\beta_{0}^{i}$    is a learnable parameter, set uniquely for different attention heads and layers. Refer to Ap- pendix  G  for more details. ", "page_idx": 5, "bbox": [70, 600, 290, 641.4024658203125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 78, "type": "text", "text": "To train the re-weighting vector    $\\beta=\\left\\{\\beta_{0}^{i}\\right\\}$  \t , we utilize an auxiliary training set  $(X_{t r a i n},Y_{t r a i n})$  . Here, we perform ICL with normal demonstrations and optimize    $\\beta$   with respect to the classification loss  $\\mathcal{L}$   on    $(X_{t r a i n},Y_{t r a i n})$  : ", "page_idx": 5, "bbox": [70, 634.6282348632812, 290, 709.1484375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 79, "type": "equation", "text": "\n$$\n\\beta^{\\star}=\\arg\\operatorname*{min}_{\\beta}\\mathcal{L}(X_{t r a i n},Y_{t r a i n}).\n$$\n ", "text_format": "latex", "page_idx": 5, "bbox": [103, 722, 255, 743], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 80, "type": "text", "text": "This approach can be metaphorically described as \"re-weighting the anchors,\" leading us to term it as  Anchor Re-weighting . It can also be viewed as a modification of the demonstration contributions since demonstration information has been incorpo- rated into the anchors as suggested by our prior analysis in   $\\S\\ 2.2$  . Additionally, it can be interpreted as a unique adapter variant, introducing minimal parameters while preserving most of the original model. However, it is specifically designed based on our anchor hypothesis and requires fewer pa- rameters than traditional adapters. ", "page_idx": 5, "bbox": [70, 747.39501953125, 290, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 81, "type": "text", "text": "", "page_idx": 5, "bbox": [305, 71.35227966308594, 526, 206.83346557617188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 82, "type": "text", "text": "3.1.2 Experiments ", "text_level": 1, "page_idx": 5, "bbox": [305, 214, 399, 226], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 83, "type": "text", "text": "We choose one sample per class as normal demon- strations and choose four extra samples per class to form the auxiliary training set    $(\\boldsymbol{X}_{t r a i n},\\boldsymbol{Y}_{t r a i n})$  . The setup follows   $\\S~2.2$  , with results averaged over five random seeds. Owing to computational con- straints, we employ GPT2-XL for evaluation, ex- cluding GPT-J. The parameters  $\\left\\{\\beta_{0}^{i}\\right\\}$  \t are trained using gradient descent. More details can be found in Appendix  H . ", "page_idx": 5, "bbox": [305, 229.7589874267578, 526, 351.2984619140625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 84, "type": "text", "text": "We compare  Anchoring Re-weighting  with two baselines: (1) Vanilla ICL with the same demon- stration (1-shot per class) (2) Vanilla ICL, where the auxiliary training set of  $\\beta$   is included as demon- strations (5-shot per class) for a fair comparison. ", "page_idx": 5, "bbox": [305, 351.30926513671875, 526, 419.0444641113281], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 85, "type": "text", "text": "3.1.3 Results ", "text_level": 1, "page_idx": 5, "bbox": [305, 426, 373, 438], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 86, "type": "text", "text": "As Table  1  shows, the proposed anchor re- weighting significantly enhances ICL performance, particularly on the SST-2 and EmoC datasets. Be- sides, adding more demonstrations for vanilla ICL may not bring a stable accuracy boost due to the po- tential noise introduced, as discussed in  Zhao et al. ( 2021 ). Different from vanilla ICL which utilizes the extra examples to form a demonstration, we train a re-weighting vector    $\\beta$   to modulate label an- chor contributions. This shortens the input context and thus brings (almost) no extra cost to the infer- ence speed. The consistent improvements of our method suggest that the re-weighting mechanism could be a better alternative to utilize demonstra- tion examples. Furthermore, it reiterates the crucial role that anchors play in ICL. ", "page_idx": 5, "bbox": [305, 441.9700012207031, 526, 658.3534545898438], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 87, "type": "text", "text": "3.2 Anchor-Only Context Compression ", "text_level": 1, "page_idx": 5, "bbox": [306, 668, 496, 679], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 88, "type": "text", "text": "We further explore a context compression tech- nique that reduces the full demonstration to anchor hidden states for accelerating ICL inference. ", "page_idx": 5, "bbox": [305, 684.2249755859375, 526, 724.4684448242188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 89, "type": "text", "text": "3.2.1 Method ", "text_level": 1, "page_idx": 5, "bbox": [305, 732, 376, 743], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 90, "type": "text", "text": "In   $\\S~2.3$  , we find that the model output heavily re- lies on the label words, which collect information ", "page_idx": 5, "bbox": [305, 747, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 91, "type": "table", "page_idx": 6, "img_path": "layout_images/2305.14160v4_6.jpg", "table_footnote": "Table 1: The effect after adding parameter  $\\beta_{0}^{i}$  . For AGNews, due to the length limit, we only use three demonstrations per class. Our Anchor Re-weighting method achieves the best performance overall tasks. ", "bbox": [70, 70, 525, 170], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Method | SST-2. TREC AGNews EmoC | Average\nVanilla In-Context Learning ( 1-shot per class ) | 61.28 57.56 73.32 15.44 | 51.90\nVanilla In-Context Learning ( 5-shot per class ) | 64.75 60.40 52.52 9.80 46.87\nAnchor Re-weighting (1-shot per class) 90.07 60.92 81.94 41.64 | 68.64\n", "vlm_text": "The table compares the performance of different methods across several datasets and their average performance. Here are the details:\n\n- **Methods Compared:**\n  1. Vanilla In-Context Learning (1-shot per class)\n  2. Vanilla In-Context Learning (5-shot per class)\n  3. Anchor Re-weighting (1-shot per class)\n\n- **Datasets:**\n  - SST-2\n  - TREC\n  - AGNews\n  - EmoC\n\n- **Performance Scores:**\n  - Each method has a performance score for every dataset, and an average score:\n    - **Vanilla In-Context Learning (1-shot per class):** \n      - SST-2: 61.28\n      - TREC: 57.56\n      - AGNews: 73.32\n      - EmoC: 15.44\n      - Average: 51.90\n    - **Vanilla In-Context Learning (5-shot per class):**\n      - SST-2: 64.75\n      - TREC: 60.40\n      - AGNews: 52.52\n      - EmoC: 9.80\n      - Average: 46.87\n    - **Anchor Re-weighting (1-shot per class):**\n      - SST-2: 90.07\n      - TREC: 60.92\n      - AGNews: 81.94\n      - EmoC: 41.64\n      - Average: 68.64\n\nThe Anchor Re-weighting method generally performs better, especially in the SST-2 and AGNews datasets."}
{"layout": 92, "type": "text", "text": "from the demonstrations. Given the auto-regressive nature of GPT-like models, where hidden states of tokens depend solely on preceding ones, label words’ information aggregation process is inde- pendent of subsequent words. This allows for the calculation and caching of the label word hidden states    ${\\cal H}\\,=\\,\\{\\{h_{l}^{i}\\}_{i=1}^{C}\\}_{l=1}^{N}$  } }    $(h_{l}^{i}$    is the  $l$  -th layer’s hidden state of the    $i$  -th label word in the demon- stration). By concatenating    $h_{l}^{1},...,h_{l}^{C}$    at the front in each layer during inference, instead of using the full demonstration, we can speed up inference. ", "page_idx": 6, "bbox": [70, 192.3400421142578, 291, 340.97747802734375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 93, "type": "text", "text": "In our preliminary experiments, concatenating hidden states of label words alone was inadequate for completing the ICL task.   This might be due to the critical role of formatting information in helping the model to determine the output space at the target position,   as highlighted in  Min et al. ( 2022b ). As a solution, we amalgamate the hidden states of both the formatting and the label words, a method we’ve termed  Hidden anchor . ", "page_idx": 6, "bbox": [70, 342.1600036621094, 291, 465.0848388671875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 94, "type": "text", "text": "3.2.2 Experiments ", "text_level": 1, "page_idx": 6, "bbox": [70, 475, 163, 487], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 95, "type": "text", "text": "We follow the same experimental settings as  $\\S~2.2$  . We compare our Hidden anchor  input compression method with two equally efficient baselines. ", "page_idx": 6, "bbox": [70, 491.7120056152344, 291, 531.9554443359375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 96, "type": "text", "text": " $\\mathbf{Set_{anchor}}$  : This method concatenates the format- ting and label text with the input, as opposed to concatenating the hidden states at each layer. Hidden random : This approach concatenates the hid- den states of formatting and randomly selected non- label words (equal in number to Hidden anchor ). Hidden random-top : To establish a stronger baseline, we randomly select 20 sets of non-label words in Hidden random  and report the one with the highest label loyalty. ", "page_idx": 6, "bbox": [70, 533, 291, 669.782470703125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 97, "type": "text", "text": "The  Text anchor  method is included to demon- strate that the effectiveness of Hidden anchor  is at- tributed to the aggregation of information in label ", "page_idx": 6, "bbox": [70, 670.5723266601562, 291, 711.2084350585938], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 98, "type": "table", "page_idx": 6, "img_path": "layout_images/2305.14160v4_7.jpg", "table_footnote": "Table 2: Results of different compression methods on GPT2-XL and GPT-J (averaged over SST-2, TREC, AG- News, and EmoC). Acc. denotes accuracy. The best results are shown in bold. Our method achieves the best compression performance. ", "bbox": [305, 189, 526, 400], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Method Label Loyalty Word Loyalty Acc.\n\nICL (GPT2-XL) 100.00 100.00 51.90\nTeXtanchor 51.05 36.65 38.77\nHiddenrandom 48.96 5.59 39.96\nHiddenyandom-top 57.52 4.49 41.72\nHiddenanchor 79.47 62.17 45.04\nICL (GPT-J) 100.00 100.00 56.82\nTeXtanchor 53.45 43.85 40.83\nHiddenyandom 49.03 2.16 31.51\nHiddenyandom-top 71.10 11.36 52.34\nHiddenanchor 89.06 75.04 55.59\n\n", "vlm_text": "The table presents data comparing different methods or configurations for two models: ICL (GPT2-XL) and ICL (GPT-J). The table is divided into three columns: Label Loyalty, Word Loyalty, and Accuracy (Acc.). Here is a breakdown of the contents:\n\n- **ICL (GPT2-XL)**\n  - Label Loyalty: 100.00\n  - Word Loyalty: 100.00\n  - Accuracy: 51.90\n  \n  For different configurations under GPT2-XL:\n  - Text_anchor: \n    - Label Loyalty: 51.05\n    - Word Loyalty: 36.65\n    - Accuracy: 38.77\n  - Hidden_random: \n    - Label Loyalty: 48.96\n    - Word Loyalty: 5.59\n    - Accuracy: 39.96\n  - Hidden_random-top: \n    - Label Loyalty: 57.52\n    - Word Loyalty: 4.49\n    - Accuracy: 41.72\n  - Hidden_anchor: \n    - Label Loyalty: 79.47\n    - Word Loyalty: 62.17\n    - Accuracy: 45.04\n\n- **ICL (GPT-J)**\n  - Label Loyalty: 100.00\n  - Word Loyalty: 100.00\n  - Accuracy: 56.82\n  \n  For different configurations under GPT-J:\n  - Text_anchor: \n    - Label Loyalty: 53.45\n    - Word Loyalty: 43.85\n    - Accuracy: 40.83\n  - Hidden_random: \n    - Label Loyalty: 49.03\n    - Word Loyalty: 2.16\n    - Accuracy: 31.51\n  - Hidden_random-top: \n    - Label Loyalty: 71.10\n    - Word Loyalty: 11.36\n    - Accuracy: 52.34\n  - Hidden_anchor: \n    - Label Loyalty: 89.06\n    - Word Loyalty: 75.04\n    - Accuracy: 55.59\n\nThis table seems to be measuring how well different methods maintain loyalty to labels and words, as well as their respective accuracies. The \"ICL\" likely refers to \"In-Context Learning,\" and different configurations seem to influence these metrics across the two models."}
{"layout": 99, "type": "text", "text": "words, rather than the mere text of label words. If we find that Hidden anchor  surpasses Text anchor  in performance, it solidifies the notion that the ag- gregated information within label words carries significant importance. The  Hidden random  method is introduced to illustrate that anchor hidden states encapsulate most of the demonstration information among all hidden states. ", "page_idx": 6, "bbox": [305, 422.3940124511719, 526, 530.3834228515625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 100, "type": "text", "text": "We assess all compression methods using the label loyalty and word loyalty introduced in   $\\S~2.2$  , in addition to classification accuracy. ", "page_idx": 6, "bbox": [305, 531.3380126953125, 526, 571.5824584960938], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 101, "type": "text", "text": "3.2.3 Results ", "text_level": 1, "page_idx": 6, "bbox": [305, 582, 374, 594], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 102, "type": "text", "text": "We can see from Table  2  that the proposed com- pression method  Hidden anchor  achieves the best results among all three compression methods on all metrics and for both models. For example, with the GPT-J model, the compression method with anchor states only leads to a  1 . 5  accuracy drop compared to the uncompressed situation, indicating that the compression introduces negligible information loss. Further, we estimate the efficiency improvements over the original ICL. As shown in Table  3 , the speed-up ratio ranges from    $1.1\\times$   to    $2.9\\times$  , as the efficiency gain is influenced by the length of the demonstrations. We refer readers to Appendix  I  for ", "page_idx": 6, "bbox": [305, 598.35400390625, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 103, "type": "table", "page_idx": 7, "img_path": "layout_images/2305.14160v4_8.jpg", "bbox": [79, 70, 280, 114], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Model | SST-2 TREC AGNews’ EmoC\n\nGPT2-XL | 1.1x« 1.5x 2.5X 1.4x\nGPT-J 1.5x 2.2x 2.9x 1.9x\n", "vlm_text": "The table compares performance metrics for two models, GPT2-XL and GPT-J, across four datasets: SST-2, TREC, AGNews, and EmoC. The values are as follows:\n\n- **GPT2-XL:**\n  - SST-2: 1.1×\n  - TREC: 1.5×\n  - AGNews: 2.5×\n  - EmoC: 1.4×\n\n- **GPT-J:**\n  - SST-2: 1.5×\n  - TREC: 2.2×\n  - AGNews: 2.9×\n  - EmoC: 1.9×\n\nThe values seem to indicate a relative performance or improvement factor across these datasets for each model."}
{"layout": 104, "type": "text", "text": "Table 3: Acceleration ratios of the Hidden anchor  method. ", "page_idx": 7, "bbox": [69, 122.47955322265625, 291, 135.97947692871094], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 105, "type": "text", "text": "a more elaborated analysis of the speed-up ratios. Besides, we observe that the acceleration effect is more pronounced in the GPT-J model compared to GPT2-XL, demonstrating its great potential to apply to larger language models. ", "page_idx": 7, "bbox": [69, 157.1370391845703, 291, 224.47946166992188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 106, "type": "text", "text": "3.3 Anchor Distances for Error Diagnosis ", "text_level": 1, "page_idx": 7, "bbox": [70, 236, 273, 248], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 107, "type": "text", "text": "Lastly, we perform an error analysis for ICL by examining the distances between the key vectors in the attention module that correspond to the label words. ", "page_idx": 7, "bbox": [69, 254.0869903564453, 291, 307.8794860839844], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 108, "type": "text", "text": "3.3.1 Method ", "text_level": 1, "page_idx": 7, "bbox": [70, 318, 141, 329], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 109, "type": "text", "text": "Our previous analysis in  $\\S~2.3$   shows a strong cor- relation between the model output and    $A(q,p_{i})$  , which is determined by  $\\mathbf{q}_{q}\\mathbf{k}_{p_{i}}^{T}$    as per Eq.  7 . Should the key vectors    $\\mathbf{k}$   for label words    $p_{i}$   and    $p_{k}$   be similar,    $A(q,p_{i})$   and    $A(q,p_{k})$   will also likely be similar, leading to potential label confusion. Fur- thermore, considering the distribution of query vec- tors    $\\mathbf{q}_{q}$  , we employ a PCA-like method to extract the components of the key vectors along the direc- tions with significant variations in  $\\mathbf{q}_{q}$  , denoted as  $\\hat{\\mathbf{k}}$   (see Appendix  J  for details). We anticipate that the distances between these  $\\hat{\\mathbf{k}}\\mathbf{s}$  s can correspond to the category confusion of the model, thus revealing one possible origin of ICL errors. Here, we normal- ize the distances to a scale of 0-1, with 0 indicating the highest degree of category confusion: ", "page_idx": 7, "bbox": [69, 334.5419921875, 291, 552.012451171875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 110, "type": "equation", "text": "\n$$\n\\mathrm{Confinement}_{i j}^{\\mathrm{pred}}=\\frac{\\|\\hat{\\mathbf{k_{pi}}}-\\hat{\\mathbf{k_{pi_{j}}}}\\|}{\\operatorname*{max}_{s\\neq t}\\|\\hat{\\mathbf{k_{p_{s}}}}-\\hat{\\mathbf{k_{pi}}}\\|},\n$$\n ", "text_format": "latex", "page_idx": 7, "bbox": [82, 561, 259, 597], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 111, "type": "text", "text": "3.3.2 Experiments ", "text_level": 1, "page_idx": 7, "bbox": [70, 608, 164, 621], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 112, "type": "text", "text": "We utilize the GPT2-XL model and TREC dataset, as the model displays varying confusion levels be- tween categories on this dataset. We use all 500 samples of the TREC test set and use 1 demonstra- tion per class for convenience of analysis. ", "page_idx": 7, "bbox": [69, 624.9209594726562, 291, 692.263427734375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 113, "type": "text", "text": "We calculate the actual model confusion score, Confus  $\\mathbf{ion}_{i j}$  , between category    $i$   and category  $k$   us- ing the AUC-ROC metric (detailed in Appendix  K ). We then compare the predicted confusion score, pred Confusion   , and the actual confusion score, ij Confus  $\\mathbf{ion}_{i j}$  , via heatmaps. ", "page_idx": 7, "bbox": [69, 693.197998046875, 291, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 114, "type": "image", "page_idx": 7, "img_path": "layout_images/2305.14160v4_9.jpg", "img_caption": "pred (a) Confusion matrix of Confusion   . ij ", "bbox": [340, 76, 500, 234], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Abbreviation\n\nEntity\n\nDescription\n\nPerson\n\nLocation\n\nNumber\n\n0.45 0.34\n\n1\n\nAbbreviation\n\n0.89\n\ntere 0.75 0.89\n\n0.75 0.73\n\n1\n\n0.73\n\n1\n\n0.72 [sey 0.72\n\n©\nS\nEs\n‘\n3\na\n\nPerson\n\nLocation\n\n1.0\n\n0.9\n\n08\n\n0.7\n\n- 0.6\n\n-0.5\n\n-0.4\n", "vlm_text": "The image is a confusion matrix visualizing classification results for different categories: Abbreviation, Entity, Description, Person, Location, and Number. The matrix uses a color gradient scale from light to dark, representing values from 0 to 1. Each cell shows the classification accuracy or correlation between the predicted and true classes, indicating how often the predicted class fits the true label. The diagonal values (from top-left to bottom-right) typically represent the accuracy of each class, with values closer to 1 indicating better performance."}
{"layout": 115, "type": "image", "page_idx": 7, "img_path": "layout_images/2305.14160v4_10.jpg", "img_caption": "(b) Confusion matrix of   $\\mathrm{Confinement}_{i j}$  . ", "bbox": [340, 251, 500, 407], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Abbreviation\n\nEntity\n\nDescription\n\nPerson\n\nLocation\n\nNumber\n\nAbbreviation\n\n0.95 0.98\n\n0.97 0.99\n\nEntity\n\nDescription\n\nLocation\n\nNumber\n\n1.0\n\n0.9\n\n-0.6\n", "vlm_text": "The image shows a confusion matrix, which is a table used to evaluate the performance of a classification model. It includes categories like \"Abbreviation,\" \"Entity,\" \"Description,\" \"Person,\" \"Location,\" and \"Number,\" with predicted categories on one axis and actual categories on the other.\n\nThe values range from 0.58 to 1, indicating the model's performance in each category and how many instances from one category were classified into another. The diagonal values represent correct classifications, with values near 1.0 indicating high accuracy. The color intensity corresponds to the numerical values, with darker colors showing higher values. The matrix highlights strengths and weaknesses in classification performance across different categories."}
{"layout": 116, "type": "text", "text": "Figure 6: Predicted and real confusion matrix on TREC. We set undefined diagonals to  1  for better visualization. The heatmaps display similarity in confusing category pairs, particularly in lighter-colored blocks. ", "page_idx": 7, "bbox": [305, 415.6705627441406, 526, 463.54150390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 117, "type": "text", "text": "3.3.3 Results ", "text_level": 1, "page_idx": 7, "bbox": [305, 484, 374, 497], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 118, "type": "text", "text": "Figure  6  shows that the proposed approximation pred metric,  Confusion   , can identify the most confus- ij ing case (Description-Entity) and performs reason- ably well for highly confusing categories (Entity- Abbreviation, Description-Abbreviation). This high correlation indicates that ICL makes errors in categories with similar label anchors. Overall, this result demonstrates that our anchor-based anal- ysis framework could serve as an interpretation tool for better understanding ICL’s errors. ", "page_idx": 7, "bbox": [305, 500.0249938964844, 526, 635.1134643554688], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 119, "type": "text", "text": "4 Related Work ", "text_level": 1, "page_idx": 7, "bbox": [305, 645, 396, 658], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 120, "type": "text", "text": "The existing literature on in-context learning analy- sis can be broadly divided into two streams, each focusing on different aspects. The first stream ex- plores the influencing factors of ICL based on input perturbation, such as the order ( Min et al. ,  2022b ), the formatting ( Yoo et al. ,  2022 ;  Wei et al. ,  2022 ), and the selection of the demonstration ( Liu et al. , 2022 ). Designing proper demonstration construc- tion strategies ( Ye et al. ,  2023 ;  Li et al. ,  2023a ) and calibration techniques ( Zhao et al. ,  2021 ;  Min et al. ,  2022a ) could bring clear boosts to the ICL performance. The second stream investigates the inner working mechanism of ICL through different conceptual lenses, such as making an analogy of ICL to gradient descent ( von Oswald et al. ,  2022 ; Dai et al. ,  2022 ) and viewing the process of ICL as a Bayesian inference ( Xie et al. ,  2022 ). ", "page_idx": 7, "bbox": [305, 666.0989990234375, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 121, "type": "text", "text": "", "page_idx": 8, "bbox": [70, 71.74500274658203, 291, 193.28445434570312], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 122, "type": "text", "text": "In this paper, we provide a novel perspective by examining the information flow in language mod- els to gain an understanding of ICL. Our approach offers new insights and demonstrates the potential for leveraging this understanding to improve the ef- fec ti ve ness, efficiency, and interpret ability of ICL. ", "page_idx": 8, "bbox": [70, 196.07704162597656, 291, 276.9684753417969], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 123, "type": "text", "text": "5 Conclusion ", "text_level": 1, "page_idx": 8, "bbox": [70, 295, 147, 308], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 124, "type": "text", "text": "In this paper, we propose a hypothesis that label words serve as anchors in in-context learning for aggregating and distributing the task-relevant infor- mation flow. Experimental results with attention manipulation and analysis of predictions correla- tion consolidate the hypothesis holds well in GPT2- XL and GPT-J models. Inspired by the new under- standing perspective, we propose three practical applications. First, an anchor re-weighting method is proposed to improve ICL accuracy. Second, we explore a demonstration compression technique to accelerate ICL inference. Lastly, we showcase an analysis framework to diagnose ICL errors on a real-world dataset. These promising applications again verify the hypothesis and open up new direc- tions for future investigations on ICL. ", "page_idx": 8, "bbox": [70, 322.69500732421875, 291, 539.0774536132812], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 125, "type": "text", "text": "Limitations ", "text_level": 1, "page_idx": 8, "bbox": [70, 557, 131, 571], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 126, "type": "text", "text": "Our study, while providing valuable insights into in-context learning (ICL), has several limitations. Firstly, our research scope was limited to classi- fication tasks and did not delve into the realm of generative tasks. Additionally, our hypothesis was only examined within conventional ICL paradigms, leaving other ICL paradigms such as the chain of thought prompting (CoT) ( Wei et al. ,  2022 ) unex- plored. Secondly, due to hardware constraints, we mainly investigated models up to a scale of 6 bil- lion parameters. Further research that replicates our study using larger-scale models would be bene- ficial in corroborating our findings and refining the hypotheses set forth in our investigation. ", "page_idx": 8, "bbox": [70, 584.8040161132812, 291, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 127, "type": "text", "text": "Acknowledgement ", "text_level": 1, "page_idx": 8, "bbox": [306, 72, 401, 84], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 128, "type": "text", "text": "We thank all reviewers for their thoughtful and in- sightful suggestions. This work is supported in part by a Tencent Research Grant and National Natural Science Foundation of China (No. 62176002). Xu Sun is the corresponding author. ", "page_idx": 8, "bbox": [305, 92.93500518798828, 526, 160.27645874023438], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 129, "type": "text", "text": "References ", "text_level": 1, "page_idx": 8, "bbox": [306, 184, 362, 196], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 130, "type": "text", "text": "Ekin Akyürek, Dale Schuurmans, Jacob Andreas, Tengyu Ma, and Denny Zhou. 2022.  What learn- ing algorithm is in-context learning? investigations with linear models .  ArXiv preprint , abs/2211.15661. ", "page_idx": 8, "bbox": [305, 202.777587890625, 526, 247.6594696044922], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 131, "type": "text", "text": "Tom B. Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared Kaplan, Prafulla Dhariwal, Arvind Neel a kant an, Pranav Shyam, Girish Sastry, Amanda Askell, Sandhini Agarwal, Ariel Herbert-Voss, Gretchen Krueger, Tom Henighan, Rewon Child, Aditya Ramesh, Daniel M. Ziegler, Jeffrey Wu, Clemens Winter, Christopher Hesse, Mark Chen, Eric Sigler, Mateusz Litwin, Scott Gray, Benjamin Chess, Jack Clark, Christopher Berner, Sam McCandlish, Alec Radford, Ilya Sutskever, and Dario Amodei. 2020.  Language models are few-shot learners . In  Ad- vances in Neural Information Processing Systems 33: Annual Conference on Neural Information Process- ing Systems 2020, NeurIPS 2020, December 6-12, 2020, virtual . ", "page_idx": 8, "bbox": [305, 256.02655029296875, 526, 421.4565124511719], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 132, "type": "text", "text": "Ankush Chatterjee, Kedhar Nath Narahari, Meghana Joshi, and Puneet Agrawal. 2019.  SemEval-2019 task 3: EmoContext contextual emotion detection in text . In  Proceedings of the 13th International Workshop on Semantic Evaluation , pages 39–48, Minneapo- lis, Minnesota, USA. Association for Computational Linguistics. ", "page_idx": 8, "bbox": [305, 429.82257080078125, 526, 507.5815124511719], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 133, "type": "text", "text": "Damai Dai, Yutao Sun, Li Dong, Yaru Hao, Zhifang Sui, and Furu Wei. 2022.  Why can gpt learn in-context? language models secretly perform gradient descent as meta optimizers .  ArXiv preprint , abs/2212.10559. ", "page_idx": 8, "bbox": [305, 515.9475708007812, 526, 560.8295288085938], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 134, "type": "text", "text": "Qingxiu Dong, Lei Li, Damai Dai, Ce Zheng, Zhiy- ong Wu, Baobao Chang, Xu Sun, Jingjing Xu, and Zhifang Sui. 2023.  A survey for in-context learning . ArXiv preprint , abs/2301.00234. ", "page_idx": 8, "bbox": [305, 569.196533203125, 526, 614.0785522460938], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 135, "type": "text", "text": "Eduard Hovy, Laurie Gerber, Ulf Hermjakob, Chin- Yew Lin, and Deepak Ravi chandra n. 2001.  Toward semantics-based answer pinpointing . In  Proceedings of the First International Conference on Human Lan- guage Technology Research . ", "page_idx": 8, "bbox": [305, 622.444580078125, 526, 678.2855224609375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 136, "type": "text", "text": "Diederik P. Kingma and Jimmy Ba. 2015.  Adam: A method for stochastic optimization . In  3rd Inter- national Conference on Learning Representations, ICLR 2015, San Diego, CA, USA, May 7-9, 2015, Conference Track Proceedings . ", "page_idx": 8, "bbox": [305, 686.652587890625, 526, 742.4924926757812], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 137, "type": "text", "text": "Goro Kobayashi, Tatsuki Kuri bay a shi, Sho Yokoi, and Kentaro Inui. 2020.  Attention is not only a weight: ", "page_idx": 8, "bbox": [305, 750.8595581054688, 526, 773.8235473632812], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 138, "type": "text", "text": "Analyzing transformers with vector norms . In Proceedings of the 2020 Conference on Empirical Methods in Natural Language Processing (EMNLP) , pages 7057–7075, Online. Association for Computa- tional Linguistics. ", "page_idx": 9, "bbox": [81, 72.61956787109375, 290, 128.4604949951172], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 139, "type": "text", "text": "Xiaonan Li, Kai Lv, Hang Yan, Tianyang Lin, Wei Zhu, Yuan Ni, Guotong Xie, Xiaoling Wang, and Xipeng Qiu. 2023a.  Unified demonstration retriever for in- context learning .  ArXiv preprint , abs/2305.04320. ", "page_idx": 9, "bbox": [70, 136.060546875, 290, 180.94151306152344], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 140, "type": "text", "text": "Xin Li and Dan Roth. 2002.  Learning question clas- sifiers . In  COLING 2002: The 19th International Conference on Computational Linguistics . ", "page_idx": 9, "bbox": [70, 188.54156494140625, 290, 222.4645233154297], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 141, "type": "text", "text": "Yingcong Li, Muhammed Emrullah Ildiz, Dimitris Pa- pai lio poul os, and Samet Oymak. 2023b. Transform- ers as algorithms: Generalization and stability in in-context learning. ", "page_idx": 9, "bbox": [70, 230.0645751953125, 290, 274.946533203125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 142, "type": "text", "text": "Jiachang Liu, Dinghan Shen, Yizhe Zhang, Bill Dolan, Lawrence Carin, and Weizhu Chen. 2022. What makes good in-context examples for GPT-3? In Proceedings of Deep Learning Inside Out (DeeLIO 2022): The 3rd Workshop on Knowledge Extrac- tion and Integration for Deep Learning Architectures , pages 100–114, Dublin, Ireland and Online. Associa- tion for Computational Linguistics. ", "page_idx": 9, "bbox": [70, 282.54559326171875, 290, 371.2635192871094], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 143, "type": "text", "text": "Paul Michel, Omer Levy, and Graham Neubig. 2019. Are sixteen heads really better than one? In  Ad- vances in Neural Information Processing Systems 32: Annual Conference on Neural Information Process- ing Systems 2019, NeurIPS 2019, December 8-14, 2019, Vancouver, BC, Canada , pages 14014–14024. ", "page_idx": 9, "bbox": [70, 378.8625793457031, 290, 445.6625061035156], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 144, "type": "text", "text": "Sewon Min, Mike Lewis, Hannaneh Hajishirzi, and Luke Z ett le moyer. 2022a.  Noisy channel language model prompting for few-shot text classification . In Proceedings of the 60th Annual Meeting of the As- sociation for Computational Linguistics (Volume 1: Long Papers) , pages 5316–5330, Dublin, Ireland. As- sociation for Computational Linguistics. ", "page_idx": 9, "bbox": [70, 453.2625732421875, 290, 531.0205078125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 145, "type": "text", "text": "Sewon Min, Xinxi Lyu, Ari Holtzman, Mikel Artetxe, Mike Lewis, Hannaneh Hajishirzi, and Luke Zettle- moyer. 2022b.  Rethinking the role of demonstrations: What makes in-context learning work?  In  Proceed- ings of the 2022 Conference on Empirical Methods in Natural Language Processing , pages 11048–11064, Abu Dhabi, United Arab Emirates. Association for Computational Linguistics. ", "page_idx": 9, "bbox": [70, 538.62060546875, 290, 627.3375244140625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 146, "type": "text", "text": "Alec Radford, Jeffrey Wu, Rewon Child, David Luan, Dario Amodei, Ilya Sutskever, et al. 2019. Language models are unsupervised multitask learners.  OpenAI blog , 1(8):9. ", "page_idx": 9, "bbox": [70, 634.9375610351562, 290, 679.8195190429688], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 147, "type": "text", "text": "Karen Simonyan, Andrea Vedaldi, and Andrew Zis- serman. 2013. Deep inside convolutional networks: Visual ising image classification models and saliency maps.  CoRR , abs/1312.6034. ", "page_idx": 9, "bbox": [70, 687.4195556640625, 290, 732.300537109375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 148, "type": "text", "text": "Richard Socher, Alex Perelygin, Jean Wu, Jason Chuang, Christopher D. Manning, Andrew Ng, and Christopher Potts. 2013.  Recursive deep models for ", "page_idx": 9, "bbox": [70, 739.9005737304688, 290, 773.8235473632812], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 149, "type": "text", "text": "semantic compositional it y over a sentiment treebank . In  Proceedings of the 2013 Conference on Empiri- cal Methods in Natural Language Processing , pages 1631–1642, Seattle, Washington, USA. Association for Computational Linguistics. ", "page_idx": 9, "bbox": [316, 72.61956787109375, 526, 128.4604949951172], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 150, "type": "text", "text": "Hugo Touvron, Thibaut Lavril, Gautier Izacard, Xavier Martinet, Marie-Anne Lachaux, Timothée Lacroix, Baptiste Rozière, Naman Goyal, Eric Hambro, Faisal Azhar, Aurelien Rodriguez, Armand Joulin, Edouard Grave, and Guillaume Lample. 2023.  Llama: Open and efficient foundation language models .  ArXiv , abs/2302.13971. ", "page_idx": 9, "bbox": [306, 139.45654296875, 526, 217.2145233154297], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 151, "type": "text", "text": "Johannes von Oswald, Eyvind Niklasson, E. Randazzo, João Sacramento, Alexander Mor dv in tse v, Andrey Zhmoginov, and Max Vladymyrov. 2022. Trans- formers learn in-context by gradient descent .  ArXiv preprint , abs/2212.07677. ", "page_idx": 9, "bbox": [306, 228.2105712890625, 526, 284.050537109375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 152, "type": "text", "text": "Ben Wang and Aran Komatsu zak i. 2021. GPT-J- 6B: A 6 Billion Parameter Auto regressive Lan- guage Model.  https://github.com/kingoflolz/ mesh-transformer-jax . ", "page_idx": 9, "bbox": [306, 295.04656982421875, 526, 339.92852783203125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 153, "type": "text", "text": "Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, Ed Huai hsin Chi, F. Xia, Quoc Le, and Denny Zhou. 2022.  Chain of thought prompting elicits reasoning in large language models .  ArXiv preprint , abs/2201.11903. ", "page_idx": 9, "bbox": [306, 350.924560546875, 526, 406.7645263671875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 154, "type": "text", "text": "Jerry W. Wei, Jason Wei, Yi Tay, Dustin Tran, Al- bert Webson, Yifeng Lu, Xinyun Chen, Hanxiao Liu, Da Huang, Denny Zhou, and Tengyu Ma. 2023. Larger language models do in-context learning dif- ferently .  ArXiv , abs/2303.03846. ", "page_idx": 9, "bbox": [306, 417.76055908203125, 526, 473.60150146484375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 155, "type": "text", "text": "Sang Michael Xie, Aditi Raghu nathan, Percy Liang, and Tengyu Ma. 2022.  An explanation of in-context learning as implicit bayesian inference . In  The Tenth International Conference on Learning Representa- tions, ICLR 2022, Virtual Event, April 25-29, 2022 . OpenReview.net. ", "page_idx": 9, "bbox": [306, 484.5965576171875, 526, 551.3965454101562], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 156, "type": "text", "text": "Jiacheng Ye, Zhiyong Wu, Jiangtao Feng, Tao Yu, and Lingpeng Kong. 2023.  Compositional exemplars for in-context learning .  ArXiv preprint , abs/2302.05698. ", "page_idx": 9, "bbox": [306, 562.392578125, 526, 596.3154907226562], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 157, "type": "text", "text": "Kang Min Yoo, Junyeob Kim, Hyuhng Joon Kim, Hyun- soo Cho, Hwiyeol Jo, Sang-Woo Lee, Sang-goo Lee, and Taeuk Kim. 2022.  Ground-truth labels matter: A deeper look into input-label demonstrations . In  Pro- ceedings of the 2022 Conference on Empirical Meth- ods in Natural Language Processing , pages 2422– 2437, Abu Dhabi, United Arab Emirates. Association for Computational Linguistics. ", "page_idx": 9, "bbox": [306, 607.310546875, 526, 696.0285034179688], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 158, "type": "text", "text": "Xiang Zhang, Junbo Jake Zhao, and Yann LeCun. 2015. Character-level convolutional networks for text clas- sification . In  Advances in Neural Information Pro- cessing Systems 28: Annual Conference on Neural In- formation Processing Systems 2015, December 7-12, 2015, Montreal, Quebec, Canada , pages 649–657. ", "page_idx": 9, "bbox": [306, 707.0235595703125, 526, 773.8235473632812], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 159, "type": "text", "text": "Table 4: Demonstration templates and label words. Here  $_{<\\!S1>}$   represents the demonstration,  ${<}S>$   represents the input to be predicted, and  ${<}\\mathrm{L}{>}$   represents the label word corresponding to the demonstration. To save space, we only show one demonstration for each task. ", "page_idx": 10, "bbox": [69, 70.029541015625, 290, 129.8555145263672], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 160, "type": "table", "page_idx": 10, "img_path": "layout_images/2305.14160v4_11.jpg", "bbox": [70, 138, 290, 342], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Task\n\nTemplate\n\nLabel Words\n\nSST-2 Review: <S1> Positive, Negative\nSentiment: <L>\nReview: <S>\nSentiment:\n\nTREC Question: <S1> Abbreviation, Entity\nAnswer Type: <L> Description, Person\nQuestion: <S> Location, Number\nAnswer Type:\n\nAGNews Article: <S1> World, Sports\n\nAnswer: <L> Business, Technology\nArticle: <S>\nAnswer:\n\nEmoC Dialogue: <S1> Others, Happy\n\nEmotion: <L>\nDialogue: <S>\nEmotion:\n\nSad, Angry\n", "vlm_text": "The table outlines templates and label words for different tasks. Here's a breakdown:\n\n1. **SST-2 Task**\n   - **Template**: \n     - Review: `<S1>`\n     - Sentiment: `<L>`\n     - Review: `<S>`\n     - Sentiment:\n   - **Label Words**: Positive, Negative\n\n2. **TREC Task**\n   - **Template**: \n     - Question: `<S1>`\n     - Answer Type: `<L>`\n     - Question: `<S>`\n     - Answer Type:\n   - **Label Words**: Abbreviation, Entity, Description, Person, Location, Number\n\n3. **AGNews Task**\n   - **Template**: \n     - Article: `<S1>`\n     - Answer: `<L>`\n     - Article: `<S>`\n     - Answer:\n   - **Label Words**: World, Sports, Business, Technology\n\n4. **EmoC Task**\n   - **Template**: \n     - Dialogue: `<S1>`\n     - Emotion: `<L>`\n     - Dialogue: `<S>`\n     - Emotion:\n   - **Label Words**: Others, Happy, Sad, Angry\n\nEach task involves different text inputs (S1, S) and corresponding label outputs (L)."}
{"layout": 161, "type": "text", "text": "Zihao Zhao, Eric Wallace, Shi Feng, Dan Klein, and Sameer Singh. 2021.  Calibrate before use: Improv- ing few-shot performance of language models . In Proceedings of the 38th International Conference on Machine Learning, ICML 2021, 18-24 July 2021, Vir- tual Event , volume 139 of  Proceedings of Machine Learning Research , pages 12697–12706. PMLR. ", "page_idx": 10, "bbox": [69, 362.0785827636719, 290, 439.8365173339844], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 162, "type": "text", "text": "Appendix ", "text_level": 1, "page_idx": 10, "bbox": [71, 452, 121, 466], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 163, "type": "text", "text": "A Experimental Settings ", "text_level": 1, "page_idx": 10, "bbox": [70, 474, 205, 488], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 164, "type": "text", "text": "For models, we use GPT2-XL (1.5B) ( Radford et al. ,  2019 ) and GPT-J (6B) ( Wang and Komat- suzaki ,  2021 ) in this paper. ", "page_idx": 10, "bbox": [69, 496.54498291015625, 290, 536.7884521484375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 165, "type": "text", "text": "For datasets, we use a sentiment analysis task, Stanford Sentiment Treebank Binary (SST- 2) ( Socher et al. ,  2013 ), a question type classifi- cation task, Text REtrieval Conference Question Classification (TREC) ( Li and Roth ,  2002 ;  Hovy et al. ,  2001 ), a topic classification task, AG’s news topic classification dataset (AGNews) ( Zhang et al. , 2015 ), and an emotion classification task, Emo- Context (EmoC) ( Chatterjee et al. ,  2019 ). The ICL templates of these tasks are shown in Table  4 . ", "page_idx": 10, "bbox": [69, 537.5570068359375, 290, 672.6454467773438], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 166, "type": "text", "text": "B Results of    $S_{w p},S_{p q},$  , and    $S_{w w}$   on TREC and EmoC ", "text_level": 1, "page_idx": 10, "bbox": [70, 683, 286, 711], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 167, "type": "text", "text": "Figure  7  illustrates the relative sizes of    $S_{w p}$  ,    $S_{p q}$  , and  $S_{w w}$   on TREC and EmoC, mirroring results on SST-2 and AGNews. In shallow layers,    $S_{w p}$   (the information flow from the text part to label words) ", "page_idx": 10, "bbox": [69, 720.2960205078125, 290, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 168, "type": "image", "page_idx": 10, "img_path": "layout_images/2305.14160v4_12.jpg", "img_caption": "Figure 7: Relative size of    $S_{w p}$  ,    $S_{p q}$  , and    $S_{w w}$   on TREC and EmoC, which is similar to that on SST-2 and AG- News. ", "bbox": [304, 81, 527, 438], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\nog\n\n0.6\n\n0.4\n\n02\n\n0.0\n\n1.0\n\nog\n\n0.6\n\n04\n\n02\n\n0.0\n\n°\n\n10 20 30 40\nLayer\n\n(a) Results on the TREC dataset\n\n°\n\n10 20 30 40\nLayer\n\n(b) Results on the EmoC dataset\n\n", "vlm_text": "The image contains two line graphs comparing the relative sizes of \\(S_{wp}\\), \\(S_{pq}\\), and \\(S_{ww}\\) across different layers on the TREC and EmoC datasets.\n\n- **Graph (a):** Results on the TREC dataset.\n  - **\\(S_{wp}\\):** Represented by a blue line, showing a generally decreasing trend across layers.\n  - **\\(S_{pq}\\):** Represented by an orange line, starting with fluctuations and stabilizing at high values as layers increase.\n  - **\\(S_{ww}\\):** Represented by a green line, remaining relatively low and stable across layers.\n\n- **Graph (b):** Results on the EmoC dataset.\n  - **\\(S_{wp}\\):** Blue line with a similar decreasing trend.\n  - **\\(S_{pq}\\):** Orange line, showing fluctuations before stabilizing at high values in later layers.\n  - **\\(S_{ww}\\):** Green line, remaining consistently low.\n\nBoth graphs indicate a pattern where \\(S_{pq}\\) dominates in higher layers."}
{"layout": 169, "type": "text", "text": "is prominent, while  $S_{p q}$   (the information flow from label words to targeted positions) is less signifi- cant. However, in deeper layers,    $S_{p q}$   dominates. Importantly,    $S_{w p}$   and    $S_{p q}$   generally exceed    $S_{w w}$  , indicating that interactions involving label words are predominant. ", "page_idx": 10, "bbox": [305, 460.9889831542969, 526, 541.8804321289062], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 170, "type": "text", "text": "C Reason for Using Word Loyalty Besides Label Loyalty ", "text_level": 1, "page_idx": 10, "bbox": [305, 554, 488, 582], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 171, "type": "text", "text": "Label loyalty alone may not capture changes in the probability distribution of non-label words or the relative ratio of the probability of the label words within the entire vocabulary. Word loyalty helps address this limitation, which is shown in Table  5 . ", "page_idx": 10, "bbox": [305, 590.8419799804688, 526, 658.1844482421875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 172, "type": "text", "text": "D Isolating Different Numbers of Layers ", "text_level": 1, "page_idx": 10, "bbox": [305, 670, 523, 685], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 173, "type": "text", "text": "We study the impact of the numbers of isolated layers, as shown in Figures  8a  and  8b . It can be found that isolating shallow layers cause a signifi- cant impact, isolating deep layers has a negligible impact on the model, even when the number of isolation layers increases. This further illustrates ", "page_idx": 10, "bbox": [305, 693.197998046875, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 174, "type": "table", "page_idx": 11, "img_path": "layout_images/2305.14160v4_13.jpg", "table_caption": "Table 5: Results on a test sample with the label “World” from AGNews. ", "bbox": [89, 69, 504, 145], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Isolation Layer Output Label Vs (sorted by probability)\n\nFirst 5 layers World “\\n’, “ The’, “ Google”,““<lendoftextl>”, “ A”\nNo isolation World “World”, “ Technology”, “ Politics”, “ Israel’, ““ Human”\n\n", "vlm_text": "The table appears to compare results from different configurations of an isolation layer in a model, possibly related to natural language processing or text prediction. It consists of three columns:\n\n1. **Isolation Layer**: This column specifies the configuration used.\n   - \"First 5 layers\" indicates that the first five layers of the model were isolated.\n   - \"No isolation\" indicates that no layers were isolated.\n\n2. **Output Label**: This column shows the resulting label from the model.\n   - In both cases (\"First 5 layers\" and \"No isolation\"), the output label is \"World.\"\n\n3. **V₅ (sorted by probability)**: This column lists the most probable next elements predicted by the model, sorted by probability.\n   - For \"First 5 layers\", the predicted elements are: \"\\n\", \"The\", \"Google\", \"<endoftext>\", \"A\".\n   - For \"No isolation\", the predicted elements are: \"World\", \"Technology\", \"Politics\", \"Israel\", \"Human\".\n\nThe table is essentially showing how the isolation of the first 5 layers affects the model's output predictions compared to when there is no isolation. By isolating the first 5 layers, the model's predictions seem to become more generic or placeholder-like, while without isolation, the predictions are more content-specific."}
{"layout": 175, "type": "image", "page_idx": 11, "img_path": "layout_images/2305.14160v4_14.jpg", "img_caption": "(a) Effect of different numbers of isolated layers on GPT2- XL ", "bbox": [72, 166, 287, 331], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Loyalty\n\n1.0\n\n0.8\n\n0.4\n\n0.2\n\n0.0\n\n— Label Loyalty (First)\nLabel Loyalty (Last)\n— Word Loyalty (First)\n\n=== Word Loyalty (Last) ———______\n\n0 1 2 3\nIsolation Layer Num\n\n", "vlm_text": "This image is a line graph showing the effect of different numbers of isolated layers on GPT-2 XL. The x-axis represents the \"Isolation Layer Num\" ranging from 0 to 3. The y-axis represents \"Loyalty\" scores ranging from 0 to 1. \n\nThere are four lines representing different types of loyalty:\n- Blue solid line: Label Loyalty (First)\n- Blue dashed line: Label Loyalty (Last)\n- Red solid line: Word Loyalty (First)\n- Red dashed line: Word Loyalty (Last)\n\nThe blue lines (Label Loyalty) show a moderate decline as the number of isolation layers increases. The red solid line (Word Loyalty First) shows a steep decline with the increase in isolation layers, while the red dashed line (Word Loyalty Last) remains constant at the top."}
{"layout": 176, "type": "image", "page_idx": 11, "img_path": "layout_images/2305.14160v4_15.jpg", "img_caption": "(b) Effect of different numbers of isolated layers on GPT-J ", "bbox": [72, 343, 286, 497], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.8\n\nLoyalty\n\n0.4\n\n0.2\n\n— Label Loyalty (First)\nLabel Loyalty (Last)\n— Word Loyalty (First)\nWord Loyalty (Last)\n\n0 1 2 3\nIsolation Layer Num\n\n", "vlm_text": "The image is a line graph showing the effect of different numbers of isolated layers on GPT-J. The x-axis is labeled \"Isolation Layer Num,\" and the y-axis is labeled \"Loyalty.\" \n\nThere are four lines on the graph:\n\n- A solid blue line representing \"Label Loyalty (First)\"\n- A dashed blue line representing \"Label Loyalty (Last)\"\n- A solid red line representing \"Word Loyalty (First)\"\n- A dashed red line representing \"Word Loyalty (Last)\"\n\nThe graph indicates how loyalty metrics change as the number of isolation layers increases from 0 to 3."}
{"layout": 177, "type": "text", "text": "Figure 8: The chart demonstrates variations in label loyalty and word loyalty, dependent on whether label or non-label words are isolated in various layers. ’First’ refers to the first several layers, while ’Last’ to the last ones. Deep-colored lines represent label word isolation, whereas light colors denote non-label words. Remark- ably, isolating label words in the shallow layers signif- icantly influences the outcome, regardless of whether this is compared to isolation in deep layers or to non- label word isolation. ", "page_idx": 11, "bbox": [70, 507.36456298828125, 290, 626.9655151367188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 178, "type": "text", "text": "the important role of information aggregation via label words in the shallow layers. ", "page_idx": 11, "bbox": [70, 648.2650146484375, 290, 674.95947265625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 179, "type": "text", "text": "E Details for the Calculation of AUCROC l ", "text_level": 1, "page_idx": 11, "bbox": [70, 684, 239, 712], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 180, "type": "text", "text": "Suppose the positions of the label words in the input    $x$   are  $p_{1},...,p_{C}$   (without loss of generality, we suppose    $p_{i}$   corresponds to the  i th class), the targeted position is    $q$  , the sum of the attention ma- trices of all attention heads at the    $l$   layer is    $A_{l}$  . We postulate that there’s a strong correlation be- tween the attention distributions on the label words of the target position    $(A_{l}(q,p_{1}),...,A_{l}(q,p_{C}))$   and the model’s final prediction. We use the AUC- ROC score to quantify this correlation. We re- gard    $(A_{l}(q,p_{1}),...,A_{l}(q,p_{C}))$   as a classifier’s pre- diction for the model output label (that is,    $A_{l}(q,p_{i})$  is equivalent to the probability of model outputting label    $i$  ), and compute the AUC-ROC value of this prediction relative to the actual model output. We denote this as    $\\mathrm{AUCRO C}_{l}$  . For the case with more demonstrations (Appendix  F.1 ), we simply sum up all    $A_{l}(q,p)$   of the same class. ", "page_idx": 11, "bbox": [70, 720.2960205078125, 290, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 181, "type": "text", "text": "", "page_idx": 11, "bbox": [305, 166.8360137939453, 526, 356.1204833984375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 182, "type": "text", "text": "F Additional Experimental Results ", "text_level": 1, "page_idx": 11, "bbox": [306, 367, 494, 382], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 183, "type": "text", "text": "F.1 Results with More Demonstrations ", "text_level": 1, "page_idx": 11, "bbox": [305, 390, 494, 403], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 184, "type": "text", "text": "We implement our experimental analysis utilizing two demonstrations per class, resulting in a total of 4, 12, 8, and 8 demonstrations respectively for SST-2, TREC, AGNews, and EmoC. Our findings, as depicted in Figure  9 , Figure  10 , and Figure  11 , exhibit a high degree of similarity to the results obtained from experiments that employ one demon- stration per class. ", "page_idx": 11, "bbox": [305, 407.6910095214844, 526, 515.680419921875], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 185, "type": "text", "text": "F.2 Results for In-Context Learning with semantically-unrelated labels ", "text_level": 1, "page_idx": 11, "bbox": [305, 526, 505, 553], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 186, "type": "text", "text": "The applicability of our analytical conclusions to ICL variants, such as the semantically unrelated la- bel ICL ( Wei et al. ,  2023 ), is an intriguing subject. Given that both GPT2-XL and GPT-J-6B perform at levels akin to random guessing in this ICL set- ting, we chose LLaMA-33B ( Touvron et al. ,  2023 ) and SST-2 for our experiment. We substituted la- bels with   ${}^{\\prime}\\mathrm{A}^{\\prime}/{}^{\\prime}\\mathrm{B}^{\\prime}$  , and adhered to a similar experi- mental setup as in sections   $\\S~2.2$   and   $\\S~2.3$  . How- ever, we applied eight shots per class to facilitate the model in achieving an accuracy of   $83.0\\%$   on SST-2. The outcomes align with those derived in  $\\S~2.2$   and   $\\S~2.3$  . Figure  12  shows the more pro- nounced impact of isolating labels in the shallow layers compared to their isolation in the deep layers or the isolation of non-label tokens. Figure  13  con- ", "page_idx": 11, "bbox": [305, 557.7059936523438, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 187, "type": "image", "page_idx": 12, "img_path": "layout_images/2305.14160v4_16.jpg", "img_caption": "(a) Results on the SST-2 dataset ", "bbox": [82, 91, 245, 231], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n08\n\n0.6\n\n0.4\n\n0.2\n\n0.0\n\n10\n\n20\n\nLayer\n\n30\n\n40\n\n", "vlm_text": "The image is a line graph depicting results on the SST-2 dataset across different layers of a model, with the x-axis labeled \"Layer\" ranging from 0 to 50 and the y-axis labeled \"S\" ranging from 0 to 1. The graph shows three different lines:\n\n1. A blue line labeled \\( S_{wp} \\) which starts with some fluctuations, decreases towards zero around layer 20, and remains close to zero in later layers.\n2. An orange line labeled \\( S_{pq} \\) which shows some initial fluctuations, increases sharply around layer 10, and remains close to 1 past layer 20.\n3. A green line labeled \\( S_{ww} \\) which starts with small fluctuations and remains close to zero across all layers.\n\nThese lines represent some measures or metrics plotted over the layers of a neural network trained or evaluated on the SST-2 (Stanford Sentiment Treebank) dataset."}
{"layout": 188, "type": "image", "page_idx": 12, "img_path": "layout_images/2305.14160v4_17.jpg", "img_caption": "(b) Results on the TREC dataset ", "bbox": [83, 257, 244, 398], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n08\n\n0.6\n\n0.4\n\n0.2\n\n0.0\n\n— Sup\n— Soa\nSun\n\n10\n\n20\n\nLayer\n\n30\n\n40\n\n", "vlm_text": "The image is a line graph showing results on the TREC dataset. It has three lines that represent different variables: \n\n- \\(S_{wp}\\) (in blue)\n- \\(S_{pq}\\) (in orange)\n- \\(S_{ww}\\) (in green)\n\nThe x-axis is labeled \"Layer,\" and the y-axis is labeled \"S.\" The graph indicates how these three variables change across different layers, with \\(S_{pq}\\) generally having higher values compared to the other two."}
{"layout": 189, "type": "image", "page_idx": 12, "img_path": "layout_images/2305.14160v4_18.jpg", "img_caption": "(c) Results on the AGNews dataset ", "bbox": [83, 424, 245, 565], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n08\n\n0.6\n\n0.4\n\n0.2\n\n0.0\n\n— Sup\n—\n\n— Saw\n\n10\n\n20\n\nLayer\n\n30\n\n40\n\n", "vlm_text": "The image is a line graph illustrating the results on the AGNews dataset. It plots three different measurements across various layers (0 to 50) on the x-axis. The y-axis represents the values of these measurements (denoted as \\( S \\)) ranging from 0 to 1. \n\nThe three lines are:\n\n- \\( S_{wp} \\): Blue line, showing a peak around layer 5 and then gradually decreasing.\n- \\( S_{pq} \\): Orange line, starting low, peaking sharply around layer 10, and then stabilizing near 1.\n- \\( S_{ww} \\): Green line, maintaining a low and consistent value across all layers.\n\nEach line represents different metrics or measurements across the model's layers."}
{"layout": 190, "type": "image", "page_idx": 12, "img_path": "layout_images/2305.14160v4_19.jpg", "img_caption": "(d) Results on the EmoC dataset ", "bbox": [83, 590, 244, 732], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n08\n\n0.6\n\n0.4\n\n0.2\n\n0.0\n\n— Sup\n— Spa\n\n— Sw\n\n10\n\n20\n\nlayer\n\n30\n\n40\n\n", "vlm_text": "The image is a line graph depicting results on the EmoC dataset. It measures the variable \\( S \\) across different layers, ranging from 0 to 50. There are three different lines represented:\n\n- The blue line (\\( S_{wp} \\)) starts fluctuating around 0.3, increases and decreases erratically, and then stabilizes at a lower level around 0.1 after layer 30.\n- The orange line (\\( S_{pq} \\)) starts around 0.5, exhibits some fluctuations, and then rises sharply to stabilize near 1.0 from around layer 20 onward.\n- The green line (\\( S_{ww} \\)) starts just above 0 and shows a series of minor fluctuations around the 0.1 mark but remains relatively low compared to the other two lines.\n\nThe x-axis represents the layer number, while the y-axis represents the \\( S \\) value."}
{"layout": 191, "type": "text", "text": "Figure 9: Relative sizes of    $S_{w p}$  ,    $S_{p q}$  , and    $S_{w w}$   when more demonstrations are employed. ", "page_idx": 12, "bbox": [70, 740.9325561523438, 289.1335754394531, 764.8925170898438], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 192, "type": "image", "page_idx": 12, "img_path": "layout_images/2305.14160v4_20.jpg", "img_caption": "(a) Effect of different numbers of isolated layers on GPT2- XL ", "bbox": [308, 73, 522, 235], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.8\n\nLoyalty\n\n0.4\n\n0.2\n\n0.0\n\n— Label Loyalty (First)\n--- Label Loyalty (Last)\n— Word Loyalty (First)\n\n--- Word Loyalty (Last) ———____\n\n0 1 2 3\nIsolation Layer Num\n\n", "vlm_text": "The image is a line graph showing the effect of different numbers of isolated layers on GPT-2 XL. The x-axis represents the \"Isolation Layer Num,\" and the y-axis represents \"Loyalty.\"\n\nThere are four lines on the graph:\n\n1. Blue solid line: Label Loyalty (First)\n2. Blue dashed line: Label Loyalty (Last)\n3. Red solid line: Word Loyalty (First)\n4. Red dashed line: Word Loyalty (Last)\n\nAs the number of isolated layers increases from 0 to 3, Label Loyalty (First and Last) remains relatively stable, while Word Loyalty (First and Last) decreases significantly."}
{"layout": 193, "type": "image", "page_idx": 12, "img_path": "layout_images/2305.14160v4_21.jpg", "img_caption": "(b) Effect of different numbers of isolated layers on GPT-J ", "bbox": [309, 248, 522, 403], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.8\n\nLoyalty\n\n0.4\n\n0.2\n\n— Label Loyalty (First)\n=== Label Loyalty (Last)\n— Word Loyalty (First)\n--- Word Loyalty (Last)\n\n0 1 2 3\nIsolation Layer Num\n\n", "vlm_text": "The image is a line graph showing the effect of different numbers of isolated layers on GPT-J, focusing on \"Loyalty.\" The x-axis represents the \"Isolation Layer Num,\" ranging from 0 to 3, and the y-axis represents \"Loyalty,\" ranging from 0 to 1.\n\nThere are four lines plotted:\n\n- **Label Loyalty (First)**: Solid blue line.\n- **Label Loyalty (Last)**: Dashed blue line.\n- **Word Loyalty (First)**: Solid red line.\n- **Word Loyalty (Last)**: Dashed red line.\n\nGenerally, the graph shows how these loyalty metrics change with the number of isolated layers. The blue lines appear to slightly decrease, while the solid red line remains constant and the dashed red line slightly decreases."}
{"layout": 194, "type": "text", "text": "Figure 10: Variations in label loyalty and word loyalty when more demonstrations are employed. ", "page_idx": 12, "bbox": [305, 412.2735595703125, 526, 436.2335205078125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 195, "type": "text", "text": "firmed that the model leverages information from anchors in the deeper layers to perform classifica- tion. ", "page_idx": 12, "bbox": [305, 464.19500732421875, 526, 504.4384765625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 196, "type": "text", "text": "G Implementation of Anchor Re-weighting ", "text_level": 1, "page_idx": 12, "bbox": [305, 525, 464, 554], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 197, "type": "text", "text": "In order to implement anchor re-weighting, spe- cific adjustments are made in the model’s compu- tational process. After calculating the attention matrix    $A_{l}^{h}$    of the  h th head in the  l th layer, we mul- tiply each  $A_{l}^{h}(q,p_{i})$   by    $\\exp(\\beta_{0,l h}^{i})$   before proceed- ing with further computations. This means that for each attention head, we introduce the following modifications: ", "page_idx": 12, "bbox": [305, 568.8429565429688, 526, 676.8334350585938], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 198, "type": "equation", "text": "\n$$\n\\begin{array}{l l}{\\mathrm{Attention}_{l}^{h}(Q,K,V)=\\hat{A}_{l}^{h}V,}\\\\ {A_{l}^{h}=\\mathrm{softmax}\\left(\\displaystyle\\frac{Q K^{T}}{\\sqrt{d}}\\right),}\\\\ {\\hat{A}_{l}^{h}(k,j)=\\left\\{\\exp(\\beta_{0,l h}^{i})A_{l}^{h}(k,j),}&{\\mathrm{if}\\;k=q,j=p_{i}\\;.}\\\\ {A_{l}^{h}(k,j),}&{\\mathrm{otherwise}}\\end{array}\\right.}\\end{array}\n$$\n ", "text_format": "latex", "page_idx": 12, "bbox": [313, 690, 516, 765], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 199, "type": "image", "page_idx": 13, "img_path": "layout_images/2305.14160v4_22.jpg", "img_caption": "(a) GPT2-XL (total 48 layers). ", "bbox": [78, 71, 279, 227], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.8\n\n0.6\n\n0.2\n\n0.0\n\nRy\n\n=-- AUCROC,\n\n0.9\n\n0.8\n\nty\n3\n'youonv\n\n0.6\n\n50\n\n40\n\n30\n\n20\n\n10\n\nLayers\n", "vlm_text": "This graph is a plot of two metrics over 48 layers of the GPT2-XL model. \n\n- The x-axis represents the layers (from 0 to 48).\n- The left y-axis is labeled AUROC₁, and the blue dashed line represents this metric. It appears to show the value increasing across the layers, peaking around the 30th to 40th layers, and then it slightly decreases.\n- The right y-axis is labeled R₁, and the red solid line represents this metric. It steadily increases with the number of layers.\n\nThe plot suggests a relationship between the model layers and the metrics AUROC₁ and R₁."}
{"layout": 200, "type": "image", "page_idx": 13, "img_path": "layout_images/2305.14160v4_23.jpg", "img_caption": "(b) GPT-J (total 28 layers). ", "bbox": [78, 238, 278, 394], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.8\n0.6\n0.4\n0.2\n0.0\n\nRy\n\nAUCROC,\n\n5\no\n'youonv\n\n0.9\n0.8\n0.6\n0.5\n\n15 20 25\nLayers\n\n10\n", "vlm_text": "The image is a line graph showing two metrics: AUROC and Rₗ, plotted against the layers of GPT-J, which has a total of 28 layers.\n\n- The blue dashed line represents AUROCₗ.\n- The red solid line represents Rₗ.\n\nBoth metrics are plotted against the number of layers, with AUROC ranging from 0.5 to around 1.0 and Rₗ ranging from 0.0 to around 1.0. The graph indicates how these metrics change across the layers."}
{"layout": 201, "type": "text", "text": "Figure 11:    $\\mathrm{AUCRO C}_{l}$   and    $R_{l}$   of each layer in GPT models when more demonstrations are employed. ", "page_idx": 13, "bbox": [70, 403.76556396484375, 290, 427.72552490234375], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 202, "type": "image", "page_idx": 13, "img_path": "layout_images/2305.14160v4_24.jpg", "img_caption": "Figure 12: The impact of isolating label words versus randomly isolating non-label words within the first or last 5 layers. Isolating label words within the first 5 layers exerts a more pronounced effect, highlighting the importance of shallow-layer information aggregation via label words. ", "bbox": [69, 443, 291, 672], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Loyalty\n\n100\n\n80\n\n60\n\n40\n\n20\n\nNo Isolation ‘mm Label Words (Last) lim Random (Last)\njm Label Words (First) lm Random (First)\n\nWord Loyalty\n\nLabel Loyalty\n(LLaMA-30B)\n\n(LLaMA-30B)\n\n", "vlm_text": "The image is a bar graph comparing the impact of isolating label words versus randomly isolating non-label words within the first or last 5 layers on loyalty for the LLaMA-30B model. \n\nKey observations:\n\n- **No Isolation** is represented by a dashed green line, indicating 100% loyalty.\n- **Label Words (First)**, shown in blue, results in lower loyalty for both label and word loyalty compared to other methods.\n- **Label Words (Last)**, shown in orange, has a high loyalty, similar to the purple bars.\n- **Random (First)**, in red, shows moderate loyalty.\n- **Random (Last)**, shown in purple, achieves high loyalty comparable to isolating label words last.\n\nThe data suggests that isolating label words in the first 5 layers has a significant effect, underlining the importance of early layer processing in the model."}
{"layout": 203, "type": "text", "text": "H Training Settings of Anchor Re-weighting ", "text_level": 1, "page_idx": 13, "bbox": [70, 695, 235, 723], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 204, "type": "text", "text": "For each random seed, we fix the demonstration and sample  1000  test samples from the test datasets as described in   $\\S~2.2$  . The optimization of parame- ", "page_idx": 13, "bbox": [70, 733.8450317382812, 290, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 205, "type": "image", "page_idx": 13, "img_path": "layout_images/2305.14160v4_25.jpg", "img_caption": "Figure 13: AUCROC l  and    $R_{l}$   of each layer of LLaMA- 33B on SST-2. Still, deep layers display higher rele- vance to model prediction, reinforcing the idea that the model extracts information from deep-layer anchors for classification. ", "bbox": [304, 70, 527, 282], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "1.0\n\n0.2\n\n0.0\n\nR,\n\n=-- AUCROC;\n\n1.0\n0.9\n\n2\n3\n\n3\n\n'Qouonv\n\n20 30 40 50 60\nLayers\n\n10\n", "vlm_text": "The image is a graph that illustrates the performance of the LLaMA-33B model on the SST-2 dataset. The x-axis represents the different layers of the model, while there are two y-axes representing different metrics: AUCROC (in blue) on the left and \\( R_l \\) (in red) on the right.\n\n- The blue dashed line corresponds to the AUCROC metric across the layers, starting relatively low and then demonstrating fluctuations with peaks as high as near 1.0.\n- The red line represents the \\( R_l \\) metric which starts from a lower value and increases steadily across the layers, indicating a trend of increasing relevance to model prediction as the layers deepen. \n\nThe graph caption suggests that deeper layers in the model provide higher relevance for prediction, which aligns with the idea that significant information for classification purposes is extracted from deeper layers in the neural network."}
{"layout": 206, "type": "text", "text": "ter vector    $\\beta$   is carried out using gradient descent, specifically with the Adam optimizer ( Kingma and Ba ,  2015 ). The learning rate is set at  0 . 01 , with  $\\beta_{1}=0.9$   and    $\\beta_{2}\\,=\\,0.999$  . Due to memory con- straints, we use a batch size of 1. This optimization process is repeated for  10  epochs. Owing to limi- tations in computational resources, we restrict our evaluation to the GPT2-XL model and exclude the GPT-J model from our assessment. ", "page_idx": 13, "bbox": [305, 306.36297607421875, 526, 427.9014892578125], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 207, "type": "table", "page_idx": 13, "img_path": "layout_images/2305.14160v4_26.jpg", "table_caption": "I The Factor of    $L_{\\mathbf{dim0}}$   and    $L_{\\mathbf{x}}$  ", "bbox": [305, 442, 516, 547], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "AGNews\n\nEmoC\n\n2.5\n2.9x\n\n1.4x\n1.9x\n\n151\n37\n\n53\n12\n", "vlm_text": "The table presents comparative performance metrics and lengths for two models, GPT2-XL and GPT-J, across four datasets: SST-2, TREC, AGNews, and EmoC. Here's a breakdown:\n\n**Performance Ratios:**\n- **SST-2:** \n  - GPT2-XL: 1.1×\n  - GPT-J: 1.5×\n\n- **TREC:**\n  - GPT2-XL: 1.5×\n  - GPT-J: 2.2×\n\n- **AGNews:**\n  - GPT2-XL: 2.5×\n  - GPT-J: 2.9×\n\n- **EmoC:**\n  - GPT2-XL: 1.4×\n  - GPT-J: 1.9×\n\n**Lengths:**\n- **\\( L_{\\text{demo}} \\):**\n  - SST-2: 18\n  - TREC: 61\n  - AGNews: 151\n  - EmoC: 53\n\n- **\\( L_x \\):**\n  - SST-2: 19\n  - TREC: 7\n  - AGNews: 37\n  - EmoC: 12\n\nThis data likely reflects the efficiency or capability of the models in handling specific tasks or dataset sizes."}
{"layout": 208, "type": "text", "text": "From Table  6 , we observe a correlation between the acceleration ratios and the ratio of the total demonstration length   $(L_{\\mathrm{demo}})$   to the length of the text predicted   $(L_{\\mathbf{x}})$  . It suggests that a greater ratio of total length to predicted text length may yield a higher acceleration ratio. ", "page_idx": 13, "bbox": [305, 583.6549682617188, 526, 664.5464477539062], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 209, "type": "text", "text": "In addition, the table illustrates that datasets with longer demonstration lengths tend to exhibit higher acceleration ratios. For instance, the AGNews dataset, which has the longest    $L_{\\mathrm{demo}}$  , presents the highest acceleration ratio among the datasets ana- lyzed. These findings could indicate an increased efficiency of the Hidden anchor  method in contexts involving longer demonstration lengths. ", "page_idx": 13, "bbox": [305, 666.0989990234375, 526, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 210, "type": "text", "text": "J Calculation of  $\\hat{\\mathbf{k}}$  ", "text_level": 1, "page_idx": 14, "bbox": [70, 72, 171, 85], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 211, "type": "text", "text": "For the sampled sequence    $x_{1},...,x_{T}$   to be pre- dicted, we denote the query vectors of the target po- sitions as  $\\mathbf{q}_{1},...,\\mathbf{q}_{T}$  . We then compute the matrix  $\\hat{\\mathbf{Q}}=(\\mathbf{q}_{1}-\\overline{{\\mathbf{q}}},...,\\mathbf{q}_{T}-\\overline{{\\mathbf{q}}})$   −  −  by subtracting the mean vector,  q , from each query vector. Subsequently, we determine the    $M$   directions,    $\\mathbf{v}_{1},...,\\mathbf{v}_{M}$  , that correspond to the M largest variation directions for the centralized query vectors    $\\hat{\\mathbf{q}}_{1},...,\\hat{\\mathbf{q}}_{T}$   . The    $i^{t h}$  direction,  $\\mathbf{v}_{i}$  , is chosen to maximize the variance of the projection of the centralized query vectors onto it, while also being orthogonal to the previously chosen directions,    $\\mathbf{v}_{1},...,\\mathbf{v}_{i-1}$  . This process can be formalized as follows: ", "page_idx": 14, "bbox": [70, 95.09003448486328, 290, 270.8254699707031], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 212, "type": "equation", "text": "\n$$\n\\begin{array}{r l}&{{\\mathbf v}_{1}=\\underset{\\left\\|{\\mathbf v}\\right\\|=1}{\\arg\\operatorname*{max}}\\,\\mathrm{Var}\\left\\{{\\mathbf v}^{\\top}\\hat{\\mathbf Q}\\right\\},}\\\\ &{{\\mathbf v}_{2}=\\underset{\\left\\|{\\mathbf v}\\right\\|=1,{\\mathbf v}\\bot{\\mathbf v}_{1}}{\\arg\\operatorname*{max}}\\,\\mathrm{Var}\\left\\{{\\mathbf v}^{\\top}\\hat{\\mathbf Q}\\right\\},}\\\\ &{\\dots}\\\\ &{{\\mathbf v}_{M}=\\underset{\\left\\|{\\mathbf v}\\right\\|=1,{\\mathbf v}\\bot{\\mathbf v}_{1},\\dots,{\\mathbf v}\\bot{\\mathbf v}_{M-1}}{\\arg\\operatorname*{max}}\\,\\mathrm{Var}\\left\\{{\\mathbf v}^{\\top}\\hat{\\mathbf Q}\\right\\}.}\\end{array}\n$$\n ", "text_format": "latex", "page_idx": 14, "bbox": [73, 278, 268, 385], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 213, "type": "text", "text": "We define    $\\sigma_{i}$   as the square root of the variance of the projection of  $\\hat{\\mathbf{Q}}$   onto the    $i^{t h}$    direction, i.e.,\n\n  $\\sqrt{\\mathrm{Var}\\left\\{\\mathbf{v}_{i}^{\\top}\\hat{\\mathbf{Q}}\\right\\}}$  . ", "page_idx": 14, "bbox": [70, 396.8769836425781, 290, 451], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 214, "type": "text", "text": "To derive features  $\\hat{\\mathbf{k}}\\mathbf{s}$  s, we project the key vector\n\n  $\\mathbf{k}$   onto the directions  $\\mathbf{v}_{1},...,\\mathbf{v}_{M}$   and scale the pro- jections by the corresponding standard deviations\n\n  $\\sigma_{1},...,\\sigma_{M}$  . Each feature,  $\\hat{\\mathbf{k}}_{i}$  , is thus calculated as\n\n  $\\sigma_{i}\\mathbf{v}_{i}^{T}\\mathbf{k}$  . ", "page_idx": 14, "bbox": [70, 450, 290, 520], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 215, "type": "text", "text": "the Receiver Operating Characteristic Curve (AUC- ROC) value of this classifier    $f$  , we get the degree of confusion between category    $i$   and    $k$  , termed as Confusion ij . ", "page_idx": 14, "bbox": [305, 71.74500274658203, 526, 126.10153198242188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 216, "type": "text", "text": "The computed  Confusion i  $j$   is a value that never exceeds 1. The closer  Confusion i  $j$   approximates 1, the less pronounced the confusion, and vice versa. ", "page_idx": 14, "bbox": [305, 125.94202423095703, 526, 166.18545532226562], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 217, "type": "text", "text": "We use the above metric instead of directly ana- lyzing the output labels of the model because pre- vious work has indicated the issue of insufficient output probability calibration in ICL ( Zhao et al. , 2021 ), which is greatly affected by factors such as sample ordering and model preferences for specific label words. By leveraging our defined degree of confusion,  Confus  $\\mathrm{ion}_{i j}$  , we can implicitly alleviate the disturbances arising from insufficient probabil- ity calibration on the output labels. This allows for a more accurate representation of the model’s degree of confusion for different categories, miti- gating the impact of randomness. ", "page_idx": 14, "bbox": [305, 166.5900421142578, 526, 342.3254699707031], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 218, "type": "text", "text": "L Reproducibility ", "text_level": 1, "page_idx": 14, "bbox": [306, 352, 406, 366], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 219, "type": "text", "text": "In the supplementary material, we have provided codes that allow for the faithful replication of our experiments and subsequent result analysis. To ensure consistency and reproducibility across dif- ferent devices, we have fixed the five random seeds to the values of 42, 43, 44, 45, and 46. We invite readers to delve into the code for additional imple- mentation details that may arouse their interest. ", "page_idx": 14, "bbox": [305, 373.8590087890625, 526, 481.8484802246094], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 220, "type": "text", "text": "We further examine the influence of    $M$   on the prediction confusion matrix,  Confusion i  $j^{\\mathrm{pred}}$  , as depicted in Figure  14 . Given the similarity in outcomes for various  $M$  , we settle on a value of  $M=10$   for computation of Confusion i  $j^{\\mathrm{pred}}$  . ", "page_idx": 14, "bbox": [69, 521, 290, 588.50244140625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 221, "type": "text", "text": "K Calculation of Confusion ij ", "text_level": 1, "page_idx": 14, "bbox": [71, 602, 224, 615], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 222, "type": "text", "text": "To gauge the true degree of confusion between categories  $i$   and    $k$   for a given model, we suggest utilizing the   $\\mathsf{C o n f u s i o n}_{i j}$   metric: ", "page_idx": 14, "bbox": [69, 624.6719970703125, 290, 666.5514526367188], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 223, "type": "text", "text": "First, we procure all test samples    $x_{t}$   bearing true labels    $i$   or    $k$  . We then obtain the probabilities    $p_{i}^{t}$  and  $p_{j}^{t}$    yielded by the model for categories    $i$   and    $k$  , respectively, on these samples. These probabilities are normalized to a total of 1. Essentially, we derive a classifier  $f$   that delivers the probabilities    $p_{i}^{t}$    and  $p_{j}^{t}$    for the categories    $i$   and    $k$   respectively, on the test samples    $x_{t}$  . By calculating the Area Under ", "page_idx": 14, "bbox": [69, 666.0989990234375, 290, 774.0894775390625], "page_size": [595.2760009765625, 841.8900146484375]}
{"layout": 224, "type": "image", "page_idx": 15, "img_path": "layout_images/2305.14160v4_27.jpg", "img_caption": "Figure 14: Predicted confusion matrices under    $M=5,10,20,50,100,200.$  ", "bbox": [118, 160, 485, 687], "page_size": [595.2760009765625, 841.8900146484375], "ocr_text": "Abbreviation\nEntity\nDescription\nPerson\nLocation\n\nNumber\n\nAbbreviation\n\nAbbreviation\nEntity\nDescription\nPerson\nLocation\n\nNumber\n\nAbbreviation\n\nAbbreviation\nEntity\nDescription\nPerson\nLocation\n\nNumber\n\n<\ns$\n8\n>\na\n5\n3\n2\n\n1.0\n0.44 0.31 Bike) 1 (0.81\n0.9\nwre 0.76 0.9 0.91 08\nUs\n70.6\nF0.5\n-0.4\n0.91 |0.69 Koes 0.74\n~0.3\n> © « € §\n# s 8 § 38\nGg 8 g g §&\na 3 2\n8\na\n(a) M=5\n1.0\n0.49 0.49 Bes) 1 0.85\n0.9\neee 0.73 0.89\n0.8\n0.7\n- 0.6\n0.89 0.76 0.72 -05\n0.91 0.72 Keres -0.4\n> © ©€ £ §\n# s 8 § 3\nf£ eg g &\nB 3 2\n8\na\n(c) M = 20\n1.0\n0.51 0.52 Bees\n|_— 0.9\nete 0.73 0.88 0.9\n. 0.8\n+ 0.7\n- 0.6\nrO.5\n-0.4\n\nDescription\nPerson\nLocation\nNumber\n\n(e) M = 100\n\nAbbreviation\nEntity\nDescription\nPerson\nLocation\n\nNumber\n\nAbbreviation\n\nAbbreviation\nEntity\nDescription\nPerson\nLocation\n\nNumber\n\nAbbreviation\n\nAbbreviation\nEntity\nDescription\nPerson\nLocation\n\nNumber\n\n5\ns\n8\n>\na\n5\n3\nEy\n\n1.0\n\n0.9\n0.8\n0.7\n- 0.6\n0.89 0.75 0.73 -0.5\n0.92 0.72 PREF 0.72 -0.4\no 2 ep § §&\na S$ 2\n3\na\n(b) M = 10\n1.0\n0.51 0.51 [Re\n0.9\neye 0.73 0.88 0.9\n0.8\n0.7\n- 0.6\nPas\n- 0.4\n2 oo S\n~ 3 €& 8 2\n3\na\n(d) M = 50\n1.0\n0.52 0.52 [RG\n0.9\n0.8\n0.7\n- 0.6\n-0.5\n-0.4\na S$ 2\n3\na\n(f) M = 200\n", "vlm_text": "The image contains six confusion matrices labeled (a) to (f) corresponding to different values of \\( M = 5, 10, 20, 50, 100, 200 \\). Each matrix compares predicted and actual categories such as \"Abbreviation,\" \"Entity,\" \"Description,\" \"Person,\" \"Location,\" and \"Number.\" The entries in the matrices represent the prediction accuracy for each pair of predicted and true categories, depicted with a color scale ranging from light (lower accuracy) to dark (higher accuracy)."}
